ку ки буквально печенье небольшой фрагмент данных отправленный веб сервером хранимый на компьютере пользователя веб клиент обычно веб браузер всякий раз при попытке открыть страницу сайта пересылает этот фрагмент данных веб серверу составе http запроса применяется для сохранения данных на стороне пользователя на практике обычно используется для аутентификации пользователя хранения персональных предпочтений настроек пользователя отслеживания состояния доступа пользователя ведения статистики пользователях поддержки браузерами куки приём сохранение последующая пересылка серверу сохранённых куки требуют многие сайты ограничениями доступа большинство интернет магазинов настройка оформления поведения многих веб сайтов по индивидуальным предпочтениям пользователя тоже основана на куки куки легко перехватить подменить например для получения доступа учётной записи если пользователь использует нешифрованное соединение сервером группе риска пользователи выходящие интернет при помощи публичных точек доступа wi fi не использующие при этом таких механизмов как ssl шифрование позволяет также решить другие проблемы связанные безопасностью передаваемых данных большинство современных браузеров позволяет пользователям выбрать принимать куки или нет но их отключение делает невозможной работу некоторыми сайтами кроме того по законам некоторых стран например по закону евросоюза от года сайты должны обязательном порядке запрашивать согласие перед установкой куки назначение куки используются веб серверами для различения пользователей хранения данных них примеру если вход на сайт осуществляется при помощи куки то после ввода пользователем своих данных на странице входа куки позволяют серверу запомнить что пользователь уже идентифицирован ему разрешён доступ соответствующим услугам операциям многие сайты также используют куки для сохранения настроек пользователя эти настройки могут использоваться для персонализации которая включает себя выбор оформления например википедия позволяет авторизованным пользователям выбрать дизайн сайта поисковая система google позволяет пользователям том числе не ней выбрать количество результатов поиска отображаемых на одной странице куки также используются для отслеживания действий пользователей на сайте как правило это делается целью сбора статистики рекламные компании на основе такой статистики формируют анонимные профили пользователей для более точного нацеливания рекламы понятие возможное взаимодействие между браузером сервером техническом плане куки представляют собой фрагменты данных изначально отправляемых веб сервером браузеру при каждом последующем посещении сайта браузер пересылает их обратно серверу без куки каждый просмотр веб страницы является изолированным действием не связанным просмотром других страниц того же сайта помощью же куки можно выявить связь между просмотром разных страниц кроме отправки куки веб сервером куки могут создаваться скриптами на языках вроде javascript если они поддерживаются включены браузере спецификации указывают минимальные объёмы которые должны предоставляться браузерами для хранения куки так браузер должен хранить по меньшей мере куки по байт каждая по меньшей мере куки для одного сервера или домена популярные браузеры имеют соответствующий максимум хранящихся куки для каждого домена internet explorer internet explorer opera firefox google chrome safari на практике некоторые браузеры могут накладывать более жёсткие ограничения примеру internet explorer предоставляет байт для всех куки одном домене имена куки нечувствительны регистру соответствии разделом rfc куки могут устанавливать дату их удаления этом случае они будут автоматически удалены браузером указанный срок если дата удаления не указана куки удаляются сразу как только пользователь закроет браузер таким образом указание даты истечения позволяет сохранить куки более чем на один сеанс такие куки называются постоянными например интернет магазин может использовать постоянные куки для хранения кодов предметов которые пользователь поместил корзину покупок даже если пользователь закроет браузер не совершив покупки при последующем входе ему не придётся формировать корзину заново хранение куки также может ограничиваться зависимости от веб сервера домена или поддомена где они были созданы история по одной из версий термин куки печенье происходит от волшебного печенья набора данных которые программа получает затем отправляет обратно неизменными июне года лу монтулли пришла идея использовать их при веб соединении то время он был сотрудником netscape communications которая разрабатывала по заказу пакет электронной коммерции куки стали решением проблемы надёжной реализации виртуальной корзины покупок помощью джона джаннандреа тот же год монтулли написал начальную спецификацию куки mosaic netscape beta выпущенная октября года уже поддерживала куки куки впервые начали использоваться вне лаборатории на сайте netscape определяли посещал ли пользователь сайт ранее монтулли подал заявку на патент году получил его году internet explorer начал поддерживать куки версии выпущенной октябре года хотя некоторые люди знали существовании куки уже первом квартале года широкая общественность узнала них лишь после статьи financial times от февраля года том же году куки оказались центре внимания средств массовой информации особенно из за потенциальной угрозы приватности куки были рассмотрены федеральной комиссии по торговле сша двух слушаниях годах развитие спецификаций куки на этом не остановилось частности первые обсуждения формальной спецификации начались апреле года была сформирована специальная рабочая группа рамках ietf качестве отправной точки была выбрана спецификация netscape феврале года рабочая группа определила сторонние куки как серьёзную угрозу приватности выработанная спецификация была выпущена под названием rfc феврале года ней указывалось что сторонние куки должны либо блокироваться либо хотя бы не работать по умолчанию то время рекламные компании уже вовсю использовали сторонние куки рекомендации rfc не поддерживались ни браузерах netscape ни internet explorer позднее октябре года rfc была заменена новой спецификацией rfc типы куки сессионные куки сессионные куки также известные как временные куки существуют только во временной памяти пока пользователь находится на странице веб сайта браузеры обычно удаляют сессионные куки после того как пользователь закрывает окно браузера отличие от других типов куки сессионные куки не имеют истечения срока действия поэтому браузеры понимают их как сессионные постоянные куки вместо того чтобы удаляться после закрытия браузера как это делают сессионные куки постоянные куки файлы удаляются определённую дату или через определённый промежуток времени это означает что информация куки будет передаваться на сервер каждый раз когда пользователь посещает веб сайт которому эти куки принадлежат по этой причине постоянные куки иногда называются следящие куки поскольку они могут использоваться рекламодателями для записи предпочтениях пользователя течение длительного периода времени однако они также могут использоваться мирных целях например чтобы избежать повторного ввода данных при каждом посещении сайта защищенные куки защищенные куки могут быть переданы только через шифрованное соединение то есть https они не могут передаваться по незащищенным соединениям чтобы защитить куки необходимо добавить флаг secure файл куки httponly куки файлу httponly куки нельзя обращаться помощью api на стороне клиента таких как javascript это ограничение устраняет угрозу кражи куки помощью кросс сайтового скриптинга xss тем не менее куки остается уязвимым для кросс сайтовой трассировки xst кросс сайтовых поддельных запросов xsrf этот тип куки содержит флаг httponly работа куки установка куки запрашивая страницу браузер отправляет веб серверу короткий текст http запросом например для доступа странице браузер отправляет на сервер следующий запрос host www example org браузер сервер сервер отвечает отправляя запрашиваемую страницу вместе текстом содержащим http ответ там может содержаться указание браузеру сохранить куки http ok content type text html set cookie name value содержимое страницы браузер сервер строка set cookie отправляется лишь тогда когда сервер желает чтобы браузер сохранил куки этом случае если куки поддерживаются браузером их приём включён браузер запоминает строку name value имя значение отправляет её обратно серверу каждым последующим запросом например при запросе следующей страницы браузер пошлёт серверу следующий запрос host www example org cookie name value accept браузер сервер этот запрос отличается от первого запроса тем что содержит строку которую сервер отправил браузеру ранее таким образом сервер узна ет что этот запрос связан предыдущим сервер отвечает отправляя запрашиваемую страницу возможно добавив новые куки значение куки может быть изменено сервером путём отправления новых строк set cookie name newvalue после этого браузер заменяет старое куки тем же name на новую строку куки также могут устанавливаться программами на языках типа javascript встроенными текст страниц или аналогичными скриптами работающими браузере javascript для этого используется свойство cookie объекта document document cookie например document cookie temperature создаст куки под именем temperature значением атрибуты куки кроме пары имя значение куки может содержать срок действия путь доменное имя rfc также предусматривает что куки должны обязательно иметь номер версии но это используется редко эти атрибуты должны идти после пары name newvalue разделяться точкой запятой например set cookie name newvalue expires date path domain example org образец http ответа google com содержащего куки атрибутами домен путь говорят браузеру что куки должна быть отправлена обратно на сервер при запросах url для указанного домена пути если они не указаны используются домен путь запрошенной страницы фактически куки определяются тройкой параметров имя домен путь оригинальная спецификация netscape учитывала только пару имя путь иными словами куки разными путями или доменами являются разными куки даже если имеют одинаковые имена соответственно куки меняется на новое только если новое куки имеет те же имя путь домен дата истечения указывает браузеру когда удалить куки если срок истечения не указан куки удаляется по окончании сеанса то есть закрытием браузера если же указана дата истечения срока хранения куки становится постоянной до указанной даты дата истечения указывается формате нед дд мес гггг чч мм сс gmt например set cookie rmid sdfs expires fri dec gmt path domain example net куки из примера выше имеет имя rmid значение sdfs срок его хранения истечёт декабря года путь домен example net показывают браузеру что нужно отправить куки при просмотре любой страницы домене example net условия истечения срока хранения срок хранения куки истекает следующих случаях конце сеанса например когда браузер закрывается если куки не являются постоянными дата истечения была указана срок хранения вышел браузер удалил куки по запросу пользователя заметим что сервер может узнать когда истекают сроки хранения куки только когда браузер отправляет на сервер эту информацию аутентификация куки могут использоваться сервером для опознания ранее пользователей это происходит следующим образом пользователь вводит имя пользователя пароль текстовых полях страницы входа отправляет их на сервер сервер получает имя пользователя пароль проверяет их при их правильности отправляет страницу успешного входа прикрепив куки неким идентификатором сессии эта куки может быть действительна не только для текущей сессии браузера но может быть настроена на длительное хранение каждый раз когда пользователь запрашивает страницу сервера браузер автоматически отправляет куки идентификатором сессии серверу сервер проверяет идентификатор по своей базе идентификаторов при наличии базе такого идентификатора узнаёт пользователя этот метод широко используется на многих сайтах например на yahoo википедии facebook многие браузеры частности opera firefox путём редактирования свойств куки могут управлять поведением веб сайтов изменив срок истечения непостоянных сессионных куки можно например получить формально неограниченную сессию после авторизации на каком либо сайте возможность редактирования куки стандартными средствами отсутствует internet explorer но иными механизмами например javascript пользователь может изменить куки файл более того существует возможность заменить сессионные куки постоянными указанием срока годности однако серверное программное обеспечение может отслеживать такие попытки для этого сервер выдаёт куки на определённый срок записывает дату окончания куки себя или зашифрованном виде самих куки каждый раз когда пользователь обращается серверу если куки присланный браузером имеет дату годности отличную от той что хранится на сервере или содержатся куки значит имеет место попытка подмены даты годности куки сервер может отреагировать например запросив пользователя повторную авторизацию настройка браузера просмотр настройка куки браузере firefox большинство современных браузеров поддерживает куки как правило пользователь может выбрать должны куки использоваться или нет наиболее распространены следующие настройки браузеров полное отключение куки удаление куки при закрытии браузера различение сторонних куки третьей стороны соответствующее обращение ними например ограничение или запрет для них обработка куки на основе белого или чёрного списков обновляемых пользователем или изготовителем браузера куки из чёрного списка блокируются запрет куки от определённых доменов разновидность чёрного списка установка разумных сроков истечения куки большинство браузеров поддерживающих javascript позволяют пользователю увидеть активные на данном сайте куки набрав javascript alert document cookie или javascript prompt document cookie адресной строке браузера некоторые браузеры содержат менеджер куки позволяющий пользователю выборочно просмотреть удалить куки хранящиеся браузере приватность сторонние куки существует заблуждение что куки являются программами могут самостоятельно отслеживать действия пользователей хотя это только фрагменты данных хранящиеся на компьютере браузером согласно опросу проведённому американской компанией insight express году респондентов уверены этом куки значительным образом влияют на анонимность пользователей интернета информации хотя куки отправляются только на серверы домена для которого они предназначены веб страница может подгружать изображения или другие компоненты из других доменов куки получаемые во время подгрузки этих компонентов из других доменов называются сторонними устанавливая баннеры на разных сайтах используя сторонние куки рекламная компания может отследить перемещение пользователей между этими сайтами рекламные компании используют сторонние куки для отслеживания перемещений пользователя по сайтам частности рекламная компания может отслеживать пользователей на всех сайтах где установлены их рекламные баннеры знание страниц посещённых пользователем позволяет менять направленность рекламы зависимости от предпочтений пользователя создание профиля пользователей рассматривается как потенциальная угроза приватности даже при отслеживании рамках одного домена но особенно это актуально при отслеживания на нескольких доменах использованием сторонних куки по этой причине некоторых странах куки регулируются правительство соединенных штатов приняло строгие законы отношении куки году после того как выяснилось что агентство по борьбе наркотиками сша использовало куки для отслеживания пользователей просмотревших их рекламу сети году дэниел брандт установил что цру устанавливает на компьютеры постоянные куки со сроком хранения до года когда цру было уведомлено неправомерности подобного использования куки управление заявило что это было непреднамеренно прекратило их установку декабря года брандт обнаружил что агентство национальной безопасности оставляло пару постоянных куки после обновления программного обеспечения после этого сообщения агентство немедленно отключило куки директива европейского союза ес электронных средствах связи содержит нормы касающиеся использования куки частности статья устанавливает что хранение данных том числе куки может осуществляться лишь если пользователю предоставляется информация том как эти данные используются пользователь имеет возможность отказаться от этого году директива ес внесла изменения директиву ес которые вступили силу мае изменения ужесточили требования порядку сбора информации посетителях сайтов согласно новым правилам владельцы сайтов должны получать предварительное согласие посетителей на сбор информации том числе куки сообщать действующих на сайте инструментах сбора информации мае года евросоюзе вступил силу общий регламент по защите данных заменивший действующую директиву ес относящийся ко всем сайтам посещаемым из евросоюза приравнивающий большую часть куки другим персональным данным изначальном проекте предполагалось что настройки браузера могут признаваться достаточным выражением согласия пользователя на установку куки согласно окончательной версии достаточно уведомления об установке куки спецификация включает возможность для веб сервера сообщить браузеру нарушении указывая характер собираемой информации цели сбора сюда входит использование информации полученной помощью куки по спецификации браузер может принимать или отклонять куки согласно настройкам или же спросить пользователя многие браузеры включая safari от apple internet explorer версий от microsoft поддерживают спецификации которые позволяют определить следует ли разрешать сторонние куки браузер opera позволяет пользователям отказаться от сторонних куки создать глобальные или выборочные профили безопасности для веб доменов firefox был лишён этой опции но она была восстановлена версии недостатки куки помимо проблем куки имеют некоторые технические недостатки присущие любым данным частности они не всегда точно идентифицируют пользователя могут быть причиной атак злоумышленников неточная идентификация если на компьютере используется более одного браузера то как правило каждый имеет отдельное хранилище для куки поэтому куки идентифицируют не человека сочетание учётной записи компьютера браузера таким образом любой человек который использует несколько учётных записей компьютеров или браузеров имеет несколько наборов куки аналогично куки не различают пользователей пользующихся одним компьютером браузером если не используются разные учётные записи операционной системе кража куки во время нормальной эксплуатации сервер браузер пользователя постоянно обмениваются куки поскольку куки могут содержать информацию имя пользователя условия доступа их содержимое не должно быть доступно другим кража куки это акт перехвата куки посторонними куки могут быть украдены другим компьютером читающим трафик сети куки могут быть украдены помощью анализа трафика это называется взломом сессии сетевой трафик может быть перехвачен не только его отправителем получателем особенно публичных сетях wi fi этот трафик включает себя куки передаваемые через незашифрованные http сессии там где сетевой трафик не шифруется злоумышленники могут прочесть сообщения пользователей сети том числе их куки используя программы называемые снифферами шифрование сервером данных куки снимает вопрос их безопасности однако возможна подмена куки злоумышленником для невозможности доступа даже зашифрованным куки может помочь установление между пользователем сервером шифрованного соединения использованием протокола https сервер также может использовать специальный флаг при установке куки после чего браузер будет передавать их только по надёжному каналу например через ssl соединение однако большое число веб сайтов даже использующих безопасные https сессии для идентификации пользователя затем отправляют куки другие данные более простым незашифрованным http соединением злоумышленники могут легко перехватить куки других пользователей использовать их на соответствующих веб сайтах межсайтовый скриптинг куки должны обмениваться лишь между сервером клиентом отправляются третьей стороне для того чтобы гарантировать передачу куки только через https сессию куки должны иметь атрибут secure другой способ кражи куки межсайтовый скриптинг отправка куки на серверы которые не должны получать их современные браузеры могут исполнять фрагменты кода полученные сервера если куки доступны во время этого исполнения их содержимое может той или иной форме оказаться на серверах которые не должны получать ним доступ шифрование куки не поможет этом случае следующий вид межсайтового скриптинга как правило используют на сайтах где пользователям разрешено отправлять сообщения html содержимым при вставке php javascript кода сообщение атакующий может получить куки других пользователей эти атаки можно предотвратить установкой флага httponly делающей куки недоступными для скриптов со стороны клиента тем не менее веб разработчики должны предусматривать защиту от межсайтового скриптинга на стадии разработки веб сайтов подмена куки подмена куки атакующий отправляет серверу подложные куки возможно изменив легитимные куки ранее полученные от сервера хотя теоретически куки должны сохраняться отправляться назад на сервер неизменными злоумышленник может изменить их содержимое перед отправкой примеру куки могут содержать общую сумму которую пользователь должен уплатить за свои покупки изменив это значение злоумышленник сможет заплатить меньше установленной суммы процесс изменения содержимого куки называется подменой куки для защиты от подобных атак большинство веб сайтов хранит куки лишь идентификатор сессии случайно сгенерированное число или набор символов используемое для определения сессии то время как вся другая информация хранится на сервере этом случае подмена куки значительно затрудняется межсайтовые куки атакующий использует баг браузера для отправки серверу подложных куки каждый сайт должен иметь свои собственные куки сайт не должен изменять или устанавливать куки другого сайта уязвимости веб браузеров позволяют вредоносным сайтам нарушать это правило это похоже на отправление куки но здесь злоумышленник атакует пользователей уязвимыми браузерами не сайт напрямую целью таких атак могут быть идентификаторы сессий для защиты пользователям рекомендуется использовать последние версии браузеров которых эта проблема исправлена нестабильность между клиентом сервером куки могут вызвать противоречия между клиентом сервером если пользователь получает куки затем нажимает кнопку назад браузере то состояние браузера уже другое по сравнению моментом получения куки для примера возьмем электронный магазин корзиной покупок основанной на применении куки пользователь добавляет покупку корзину затем нажимает кнопку назад но покупка остаётся корзине хотя пользователь возможно хотел отменить покупку это может привести путанице ошибкам веб разработчики должны помнить об этом принимать меры для решения таких ситуаций срок действия куки постоянные куки критикуются экспертами за свой долгий срок хранения который позволяет веб сайтам отслеживать пользователей создавать их профиль течением времени здесь затрагиваются вопросы безопасности поскольку украденные постоянные куки могут использоваться на протяжении значительного периода времени кроме того правильно составленная вредоносная программа которая может быть запущена после аутентификации пользователя сможет перенести сессионные куки на компьютер злоумышленника что первом приближении позволит посещать защищённый сайт без ввода имени пользователя пароля сколь угодно долгое время обычные куки имеют хоть очень большой но ограниченный срок жизни после чего удаляются кроме того любые куки браузере можно удалить помощью специальной опции результате браузер перестает посетителя при повторном заходе на сайт польский специалист сэмми камкар решил наиболее живучие куки результате чего появилась javascript библиотека под названием everycookie такие чудо куки теоретически позволяют любого посетителя сайта при его возвращении на страницу сайт использующий библиотеки everycookie без труда обходит все меры по сохранению анонимности хотя некоторые антивирусы могут определять такие сайты как опасные для защиты от everycookie рекомендуется использование режима private browsing либо специальных программ таких как mil shield альтернативы куки некоторые операции для которых используются куки могут быть реализованы помощью других механизмов тем не менее эти альтернативы имеют свои недостатки которые делают куки порой более на практике большинство этих альтернатив позволяет отслеживать пользователя хотя менее надёжным способом чем куки как результат частной жизни остаётся под угрозой даже если куки отключены браузером или не устанавливаются сервером ip адрес этот ненадёжный метод отслеживания пользователей основан на хранении ip адресов компьютеров просматривающих страницы данная техника доступна самого появления world wide web которая требует знания ip адреса клиента для загрузки страницы эту информацию можно хранить на сервере вне зависимости от того используются куки или нет тем не менее этот способ менее надёжен чем куки поскольку компьютеры прокси могут совместно использоваться несколькими пользователями один компьютер может использовать разные ip адреса разных сессиях динамический ip адрес отслеживание по ip адресу может оказаться невозможным при использовании систем сохранения анонимности например tor таких системах один браузер может иметь несколько ip адресов несколько пользователей могут использовать один ip адрес результате чего отслеживание ip адреса не представляется возможным некоторые крупные провайдеры включая aol пропускают весь веб трафик через сеть прокси что также делает этот метод неосуществимым url строка запроса более прогрессивная методика основана на встраивании данных url обычно для этого используется строка запроса но так же могут задействоваться другие части url языки javascript php активно используют эти механизмы при отключенных куки веб сервер добавляет строку запроса ссылке на веб страницу при её отправке браузере когда пользователь переходит по ссылке браузер возвращает строку запроса серверу этом плане строка запроса куки очень схожи они являются фрагментами информации сервера возвращаемой обратно браузером но есть определённые различия так как строка запроса является частью url то при повторном использовании этого url на сервер передастся та же информация например если опции пользователя кодированы строке запроса url пользователь отправляет этот url другому пользователю эти опции будут действовать для другого пользователя более того даже если пользователь повторно обращается одной той же странице нет никакой гарантии что строка запроса останется неизменной например при переходе внутренних страниц сайта внешних поисковых систем строки запроса будут разным когда куки оставались бы одинаковыми другой недостаток строки запроса проявляется вопросах безопасности хранение идентификатора сессии строке запроса упрощает проведение атаки передача идентификатора куки более безопасна скрытые поля формы одним из способов отслеживания сессии помощью выполняемой на стороне сервера программы является использование веб форм со скрытыми полями этот метод очень похож на строку запроса url обладает почти теми же преимуществами недостатками если параметры формы отправляются http методом get то поля фактически станут частью url который браузер отправит на сервер но большинство форм обрабатывается http post при которой информация не является ни частью url ни куки этот подход даёт два преимущества вопросе отслеживания во первых вставка информации html код post не url означает что средний пользователь её просто не заметит во вторых информация сессии не копируется копированием url например когда пользователь отправляет ссылку по электронной почте недостаток метода состоит том что информация сессии содержится html коде поэтому веб страница должна генерироваться каждый раз когда её запрашивают что увеличивает нагрузку на веб сервер http аутентификация протокол http включает себя базовую аутентификацию шифрование которые разрешают доступ странице только когда пользователь введёт правильное имя пользователя пароль если сервер запрашивает подобное то браузер обращается пользователю получив нужные данные сохраняет использует их для доступа другим страницам не требуя от пользователя вводить их заново точки зрения пользователя эффект тот же что при использовании куки имя пользователя пароль требуются лишь однажды потом пользователь получает доступ сайту при базовой аутентификации сочетание имени пользователя пароля отправляется на сервер при каждом запросе браузера незашифрованном виде это означает что если кто то перехватывает трафик он сможет получить эту информацию впоследствии использовать при шифрованной аутентификации имя пользователя пароль шифруются со случайным ключом созданным сервером сохранение на клиентской стороне некоторые веб браузеры позволяют странице сохранять информацию локально для последующего извлечения internet explorer например поддерживает сохранение информации истории избранном xml хранилище или позволяет провести прямое сохранение веб страницы на диск немного отличный механизм используется браузерах кэширующих файлы javascript используемые веб странице например страница может содержать ссылку загрузкой страницы загружается example js затем скрипт кэшируется не требует загрузки при повторном посещении страницы результате если скрипт содержит такое значение как id этот идентификатор остаётся силе может быть использован другим сценарием javascript или другой страницей запрашивающей этот скрипт см также magic cookie web storage локальные общие объекты браузер json web token примечания ссылки rfc текущая официальная спецификация для куки rfc использование механизмов управления состоянием http сессии rfc механизмы контроля состояния http сессии новая ревизия http cookies что такое cookies как ними работать категория веб категория интернет категория протокол http категория история интернета категория стандарты интернета категория всемирная паутина