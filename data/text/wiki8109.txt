ipv четвёртая версия интернет протокола ip первая широко используемая версия протокол описан rfc сентябрь года заменившем rfc январь года представление адреса ipv использует битные четырёхбайтные адреса ограничивающие адресное пространство возможными уникальными адресами традиционной формой записи ipv адреса является запись виде четырёх десятичных чисел от до разделённых точками через дробь указывается длина маски подсети форма записи пример преобразование из десятичной нотации точками точками xc xeb каждый октет преобразуется форму восьмеричная точками каждый октет преобразуется восьмеричную форму xc eb конкатенация октетов из нотации точками десятичная битное число десятичной форме восьмеричная битное число восьмеричной форме назначения подсетей некоторые адреса ipv зарезервированы для специальных целей не предназначены для глобальной маршрутизации список подсетей специального назначения определён rfc подсеть назначение маршрутизация адреса источников пакетов этой своей сети запрещена сокетах состоянием listening обозначает любые ip отправителя или любые сети получателя на текущем хосте может посылаться сеть только качестве адреса источника если хосту ещё не назначен ip адрес обычно по протоколу dhcp не может быть использован как адрес назначения сети маршрутизаторах cisco при попытке отправить пакет на адрес он будет отправлен на адрес наименьшей подсоединённой подсети connected таблице маршрутизации запрещена для использования частных сетях rfc rfc только частных сетях shared address space rfc для использования сетях сервис провайдера подсеть для коммуникаций внутри хоста см localhost используется сетевая подсистема но такие пакеты не проходят через сетевую карту если пакет таким адресом назначения был получен из сети то должен быть отброшен запрещена канальные адреса подсеть используется для автоматического назначения ip операционной системой случае если настроено получение адреса по dhcp но ни один сервер не отвечает только частных сетях для использования частных сетях rfc rfc только частных сетях ietf protocol assignments dual stack lite ds lite rfc dns для примеров документации запрещена используются для рассылки ближайшему узлу rfc глобально разрешена применяется качестве ретранслятора при инкапсуляции ipv ipv to иными словами этот ip не уникален его анонсируют многие компании пакет на этот адрес пойдёт до ближайшего хоста этим ip который распакует пакет отправит его дальше по ipv маршрутизации глобально разрешена для использования частных сетях rfc rfc только частных сетях для примеров документации запрещена для стендов тестирования только для тестов для примеров документации запрещена используются для многоадресной рассылки полный актуальный список блоков на сайте iana разъяснения по мультикастовым подсетям rfc глобально разрешена только для подсетей зарезервировано для использования будущем существует мнение что эта подсеть больше никогда не будет использована так как есть множество оборудования не способного посылать пакеты эту сеть запрещена ограниченный адрес чаще всего используется как адрес назначения при поиске dhcp серверов запрещена все остальные распределяются региональными интернет регистраторами могут быть глобально разрешена структура заголовка пакета заголовок пакета ip содержит полей из которых являются обязательными четырнадцатое поле предназначено для необязательных опций поля используют порядок байтов от старшего младшему старшие биты идут первыми первый бит имеет номер таким образом например поле версией находится четырёх старших битах первого байта при передаче многооктетных значений старший октет передаётся первым ipv header format отступ октет октет бит версия размер заголовка differentiated services code point explicit congestion notification размер пакета полный идентификатор флаги смещение фрагмента время жизни протокол контрольная сумма заголовка ip адрес источника ip адрес назначения опции если размер заголовка или или данные версия первым полем заголовка пакета является версия протокола размером четыре бита для ipv это размер заголовка internet header length следующие четыре бита содержат размер заголовка пакета битных словах поскольку число опций не постоянно указание размера важно для отделения заголовка от данных минимальное значение равно бит байт максимальное байт differentiated services code point dscp изначально называлось тип обслуживания type of service tos настоящее время определяется rfc как differentiated services используется для разделения трафика на классы обслуживания например для установки чувствительному задержкам трафику такому как voip большего приоритета указатель перегрузки explicit congestion notification ecn предупреждение перегрузке сети без потери пакетов является необязательной функцией используется только если оба хоста её поддерживают размер пакета битный полный размер пакета байтах включая заголовок данные минимальный размер равен байтам заголовок без данных максимальный байт хосты должны поддерживать передачу пакетов размером до байт но современные реализации обычно поддерживают гораздо больший размер пакеты большего размера чем поддерживает канал связи фрагментируются идентификатор преимущественно используется для идентификации фрагментов пакета если он был фрагментирован существуют эксперименты по его использованию для других целей таких как добавление информации трассировке пакета для упрощения отслеживания пути пакета подделанным адресом источника флаги поле размером три бита содержащее флаги контроля над фрагментацией биты от старшего младшему означают зарезервирован должен быть равен не фрагментировать пакета ещё есть фрагменты если установлен флаг не фрагментировать то случае необходимости фрагментации такой пакет будет уничтожен может использоваться для передачи данных хостам не имеющим достаточных ресурсов для обработки пакетов флаг есть фрагменты должен быть установлен всех фрагментов пакета кроме последнего устанавливается такой пакет считается собственным последним фрагментом смещение фрагмента поле размером бит указывает смещение поля данных текущего фрагмента относительно начала поля данных первого пакета блоках по байт позволяет байт смещения при учёте размера заголовка итоговое смещение может превысить максимальный размер пакета байт первый фрагмент имеет нулевое смещение время жизни time to live ttl пакета определяет максимальное количество маршрутизаторов на пути следования пакета наличие этого параметра не позволяет пакету бесконечно ходить по сети каждый маршрутизатор при обработке пакета должен уменьшить значение ttl на единицу пакеты время жизни которых стало равно нулю уничтожаются отправителю посылается сообщение icmp time exceeded на отправке пакетов разным временем жизни основана трассировка их пути прохождения traceroute максимальное значение ttl обычное начальное значение ttl зависит от ос протокол указывает данные какого протокола ip содержит пакет например tcp или icmp присвоенные номера протоколов можно найти на сайте iana контрольная сумма заголовка битная контрольная сумма используемая для проверки целостности заголовка каждый хост или маршрутизатор сравнивает контрольную сумму заголовка со значением этого поля отбрасывает пакет если они не совпадают целостность данных ip не проверяет она проверяется протоколами более высоких уровней такими как tcp или udp которые тоже используют контрольные суммы поскольку ttl уменьшается на каждом шаге прохождения пакета сумма тоже должна вычисляться на каждом шаге метод пересчёта контрольной суммы определён rfc адрес источника битный адрес отправителя пакета может не совпадать настоящим адресом отправителя из за трансляции адресов адрес назначения битный адрес получателя пакета также может меняться при трансляции адресов опции за адресом назначения может следовать поле дополнительных опций но оно используется редко размер заголовка этом случае должен быть достаточным чтобы вместить все опции учётом дополнения до целого числа битных слов присвоенные номера опций размещаются на сайте iana если список опций не является концом заголовка он должен оканчиваться опцией опции имеют следующий формат поле размер битах описание копировать устанавливается если требуется копировать опции заголовки всех фрагментов класс опции для управляющих опций для опций измерений отладки зарезервированы номер опции указывает опцию размер опции указывает размер опции учетом этого поля может не указываться для опций без аргументов аргументы опции переменный дополнительные данные используемые опцией замечание размер заголовка более слов указывает на присутствие опций необходимость их обработки замечание поля копировать класс опции номер опции иногда называют одним восьмибитным полем тип опции исчерпание адресного пространства уже годы стало очевидно что распределение адресного пространства происходит значительно более быстрыми темпами чем было заложено архитектуру ipv это привело сначала появлению классовой адресации позднее бесклассовой адресации конечном итоге разработке нового протокола ipv феврале года iana выделила последних блоков адресов rirам блоки свободных ip адресов начали заканчиваться региональных регистраторов года см также tcp sctp региональный интернет регистратор примечания категория tcp ip категория протоколы сетевого уровня