dhcp протокол динамической настройки узла сетевой протокол позволяющий компьютерам автоматически получать ip адрес другие параметры необходимые для работы сети tcp ip данный протокол работает по модели клиент сервер для автоматической конфигурации компьютер клиент на этапе конфигурации сетевого устройства обращается так называемому серверу dhcp получает от него нужные параметры сетевой администратор может задать диапазон адресов распределяемых сервером среди компьютеров это позволяет избежать ручной настройки компьютеров сети уменьшает количество ошибок протокол dhcp используется большинстве сетей tcp ip dhcp является расширением протокола bootp ранее для обеспечения бездисковых рабочих станций ip адресами при их загрузке dhcp сохраняет обратную совместимость bootp история стандарт протокола dhcp был принят октябре года действующая версия протокола март года описана rfc новая версия dhcp предназначенная для использования среде ipv носит название dhcpv определена rfc июль года распределение ip адресов протокол dhcp предоставляет три способа распределения ip адресов ручное распределение при этом способе сетевой администратор сопоставляет аппаратному адресу для ethernet сетей это mac адрес каждого клиентского компьютера определённый ip адрес фактически данный способ распределения адресов отличается от ручной настройки каждого компьютера лишь тем что сведения об адресах хранятся централизованно на сервере dhcp потому их проще изменять при необходимости автоматическое распределение при данном способе каждому компьютеру на постоянное использование выделяется произвольный свободный ip адрес из определённого администратором диапазона динамическое распределение этот способ аналогичен автоматическому распределению за исключением того что адрес выдаётся компьютеру не на постоянное пользование на определённый срок это называется арендой адреса по истечении срока аренды ip адрес вновь считается свободным клиент обязан запросить новый он впрочем может оказаться тем же самым кроме того клиент сам может отказаться от полученного адреса некоторые реализации службы dhcp способны автоматически обновлять записи dns соответствующие клиентским компьютерам при выделении им новых адресов это производится при помощи протокола обновления dns описанного rfc опции dhcp помимо ip адреса dhcp также может сообщать клиенту дополнительные параметры необходимые для нормальной работы сети эти параметры называются опциями dhcp список стандартных опций можно найти rfc некоторыми из наиболее часто используемых опций являются ip адрес маршрутизатора по умолчанию маска подсети адреса серверов dns имя домена dns некоторые поставщики программного обеспечения могут определять собственные дополнительные опции dhcp устройство протокола протокол dhcp является клиент серверным то есть его работе участвуют клиент dhcp сервер dhcp передача данных производится при помощи протокола udp по умолчанию запросы от клиента делаются на порт серверу сервер свою очередь отвечает на порт клиенту выдавая адрес ip другую необходимую информацию такую как сетевую маску маршрутизатор серверы dns структура сообщений dhcp все сообщения протокола dhcp разбиваются на поля каждое из которых содержит определённую информацию все поля кроме последнего поля опций dhcp имеют фиксированную длину поле описание длина байтах op тип сообщения например может принимать значения bootrequest запрос от клиента серверу bootreply ответ от сервера клиенту htype тип аппаратного адреса допустимые значения этого поля определены rfc assigned numbers например для mac адреса ethernet это поле принимает значение hlen длина аппаратного адреса байтах для mac адреса ethernet hops количество промежуточных маршрутизаторов так называемых агентов ретрансляции dhcp через которые прошло сообщение клиент устанавливает это поле xid уникальный идентификатор транзакции байта генерируемый клиентом начале процесса получения адреса secs время секундах момента начала процесса получения адреса может не использоваться этом случае оно устанавливается flags поле для флагов специальных параметров протокола dhcp ciaddr ip адрес клиента заполняется только том случае если клиент уже имеет собственный ip адрес способен отвечать на запросы arp это возможно если клиент выполняет процедуру обновления адреса по истечении срока аренды yiaddr новый ip адрес клиента предложенный сервером siaddr ip адрес сервера возвращается предложении dhcp см ниже giaddr ip адрес агента ретрансляции если таковой участвовал процессе доставки сообщения dhcp до сервера chaddr аппаратный адрес обычно mac адрес клиента sname необязательное имя сервера виде нуль терминированной строки file необязательное имя файла на сервере используемое бездисковыми рабочими станциями при удалённой загрузке как sname представлено виде нуль терминированной строки options поле опций dhcp здесь указываются различные дополнительные параметры конфигурации начале этого поля указываются четыре особых байта со значениями волшебные числа позволяющие серверу определить наличие этого поля поле имеет переменную длину однако dhcp клиент должен быть готов принять dhcp сообщение длиной байт этом сообщении поле options имеет длину байт переменная пример процесса получения адреса рассмотрим пример процесса получения ip адреса клиентом от сервера dhcp предположим клиент ещё не имеет собственного ip адреса но ему известен его предыдущий адрес процесс состоит из четырёх этапов эти этапы часто сокращаются как dora discovery offer request acknowledgement обнаружение dhcp начале клиент выполняет запрос по всей физической сети целью обнаружить доступные dhcp серверы он отправляет сообщение типа dhcpdiscover при этом качестве ip адреса источника указывается если компьютер ещё не имеет собственного ip адреса качестве адреса назначения адрес клиент заполняет несколько полей сообщения начальными значениями поле xid помещается уникальный идентификатор транзакции который позволяет отличать данный процесс получения ip адреса от других протекающих то же время поле chaddr помещается аппаратный адрес mac адрес клиента поле опций указывается последний известный клиенту ip адрес данном примере это это необязательно может быть проигнорировано сервером сообщение dhcpdiscover может быть распространено за пределы локальной физической сети при помощи специально настроенных агентов ретрансляции dhcp поступающие от клиентов сообщения dhcp серверам других подсетях не всегда процесс получения ip адреса начинается dhcpdiscover случае если клиент ранее уже получал ip адрес срок его аренды ещё не прошёл клиент может пропустить стадию dhcpdiscover начав запроса dhcprequest отправляемого идентификатором сервера который выдал адрес прошлый раз случае же отсутствия ответа от dhcp сервера выдавшего настройки прошлый раз клиент отправляет dhcpdiscover тем самым клиент начинает процесс получения начала обращаясь уже ко всем dhcp серверам сегменте сети предложение dhcp получив сообщение от клиента сервер определяет требуемую конфигурацию клиента соответствии указанными сетевым администратором настройками данном случае dhcp сервер согласен запрошенным клиентом адресом сервер отправляет ему ответ dhcpoffer котором предлагает конфигурацию предлагаемый клиенту ip адрес указывается поле yiaddr прочие параметры такие как адреса маршрутизаторов dns серверов указываются виде опций соответствующем поле это сообщение dhcp сервер отправляет хосту пославшему dhcpdiscover на его mac при определенных обстоятельствах сообщение может как рассылка клиент может получить несколько различных предложений dhcp от разных серверов из них он должен выбрать то которое его устраивает запрос dhcp выбрав одну из конфигураций предложенных dhcp серверами клиент отправляет запрос dhcp dhcprequest он рассылается при этом опциям указанным клиентом сообщении dhcpdiscover добавляется специальная опция идентификатор сервера указывающая адрес dhcp сервера выбранного клиентом данном случае подтверждение dhcp наконец сервер подтверждает запрос направляет это подтверждение dhcpack клиенту после этого клиент должен настроить свой сетевой интерфейс используя предоставленные опции вид сообщений ниже приведены значения каждого поля для каждого из отправляемых процессе сообщений dhcp обнаружение dhcp dhcpdiscover udp src dest op htype hlen hops xid secs flags ciaddr yiaddr siaddr giaddr chaddr ed sname пустое поле file пустое поле options опция dhcp обнаружение dhcp опция dhcp запрос адреса предложение dhcp dhcpoffer udp src dest op htype hlen hops xid secs flags ciaddr yiaddr xc siaddr xc giaddr chaddr ed sname пустое поле file пустое поле options опция dhcp предложение dhcp опция dhcp маска подсети опция dhcp маршрутизатор опция dhcp срок аренды ip адреса день опция dhcp dhcp сервер запрос dhcp dhcprequest udp src dest op htype hlen hops xid secs flags ciaddr yiaddr siaddr giaddr chaddr ed sname пустое поле file пустое поле options опция dhcp запрос dhcp опция dhcp запрос адреса опция dhcp dhcp сервер подтверждение dhcp dhcpack udp src dest op htype hlen hops xid secs flags ciaddr yiaddr xc siaddr giaddr chaddr ed sname пустое поле file пустое поле options опция dhcp подтверждение dhcp опция dhcp маска подсети опция dhcp маршрутизатор опция dhcp срок аренды ip адреса день опция dhcp dhcp сервер прочие сообщения dhcp помимо сообщений необходимых для первоначального получения ip адреса клиентом dhcp предусматривает несколько дополнительных сообщений для выполнения иных задач отказ dhcp если после получения подтверждения dhcpack от сервера клиент обнаруживает что указанный сервером адрес уже используется сети он рассылает сообщение отказа dhcp dhcpdecline после чего процедура получения ip адреса повторяется использование ip адреса другим клиентом можно обнаружить выполнив запрос arp сообщение отмены dhcp dhcpnak при получении такого сообщения соответствующий клиент должен повторить процедуру получения адреса освобождение dhcp клиент может явным образом прекратить аренду ip адреса для этого он отправляет сообщение освобождения dhcp dhcprelease тому серверу который предоставил ему адрес аренду отличие от других сообщений dhcp dhcprelease не рассылается информация dhcp сообщение информации dhcp dhcpinform предназначено для определения дополнительных параметров tcp ip например адреса маршрутизатора по умолчанию dns серверов теми клиентами которым не нужен динамический ip адрес то есть адрес которых настроен вручную серверы отвечают на такой запрос сообщением подтверждения dhcpack без выделения ip адреса реализации компания microsoft впервые включила сервер dhcp поставку серверной версии windows nt выпущенной году начиная windows server реализация dhcp сервера от microsoft позволяет динамически обновлять записи dns что используется active directory internet systems consortium выпустил первую версию isc dhcp server для unix подобных систем декабря года июня года вышла версия более точно соответствующая стандарту компания cisco включила сервер dhcp cisco ios феврале года sun добавила dhcp сервер solaris июле года настоящее время существуют реализации сервера dhcp для ос windows виде отдельных программ том числе открытых позволяющих выполнять роль сервера dhcp компьютерам под управлением не серверных версий данной ос примечания см также rarp bootp zeroconf wins dhcp relay ссылки rfc стандарт dhcp rfc список стандартных опций dhcp rfc dns update rfc стандарт dhcpv перечень общепринятых опций протокола dhcp указанием rfc описывающих эти опции реализация dhcp сервера от internet systems consortium для unix подобных систем руководство по dhcpd перевод man ов dhcpd лаптев андрей опция dhcp категория интернет протоколы категория протоколы прикладного уровня