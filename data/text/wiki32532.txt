nat от преобразование сетевых адресов это механизм сетях tcp ip позволяющий преобразовывать ip адреса транзитных пакетов также имеет названия ip masquerading network masquerading native address translation преобразование адреса методом nat может производиться почти любым устройством маршрутизатором сервером доступа межсетевым экраном наиболее популярным является snat суть механизма которого состоит замене адреса источника при прохождении пакета одну сторону обратной замене адреса назначения ответном пакете наряду адресами источник назначение могут также заменяться номера портов источника назначения принимая пакет от локального компьютера роутер смотрит на ip адрес назначения если это локальный адрес то пакет пересылается другому локальному компьютеру если нет то пакет надо переслать наружу интернет но ведь обратным адресом пакете указан локальный адрес компьютера который из интернета будет недоступен поэтому роутер на лету транслирует подменяет обратный ip адрес пакета на свой внешний видимый из интернета ip адрес меняет номер порта чтобы различать ответные пакеты адресованные разным локальным компьютерам комбинацию нужную для обратной подстановки роутер сохраняет себя во временной таблице через некоторое время после того как клиент сервер закончат обмениваться пакетами роутер сотрет себя таблице запись об ом порте за сроком давности помимо source nat предоставления пользователям локальной сети внутренними адресами доступа сети интернет часто применяется также destination nat когда обращения извне транслируются межсетевым экраном на компьютер пользователя локальной сети имеющий внутренний адрес потому недоступный извне сети непосредственно без nat существует базовых концепции трансляции адресов статическая static network address translation динамическая dynamic address translation маскарадная napt nat overload pat статический nat отображение ip адреса на ip адрес на основании один одному особенно полезно когда устройство должно быть доступным снаружи сети динамический nat отображает ip адрес на адрес из группы ip адресов динамический nat также устанавливает отображение между адресами но отображение может меняться зависимости от адреса доступного пуле адресов во время коммуникации перегруженный nat napt nat overload pat маскарадинг форма динамического nat который отображает несколько адресов единственный ip адрес используя различные порты известен также как pat port address translation при перегрузке каждый компьютер частной сети транслируется тот же самый адрес но различным номером порта механизм nat определён rfc rfc типы nat классификация nat часто встречающаяся связи voip термин соединение использован значении обмен пакетами udp симметричный nat symmetric nat трансляция при которой каждое соединение инициируемое парой внутренний адрес внутренний порт преобразуется свободную уникальную случайно выбранную пару публичный адрес публичный порт при этом инициация соединения из публичной сети невозможна cone nat full cone nat однозначная взаимная трансляция между парами внутренний адрес внутренний порт публичный адрес публичный порт любой внешний хост может инициировать соединение внутренним хостом если это разрешено правилах межсетевого экрана address restricted cone nat restricted cone nat постоянная трансляция между парой внутренний адрес внутренний порт публичный адрес публичный порт любое соединение инициированное внутреннего адреса позволяет дальнейшем получать ему пакеты любого порта того публичного хоста которому он отправлял пакет ранее port restricted cone nat трансляция между парой внутренний адрес внутренний порт публичный адрес публичный порт при которой входящие пакеты проходят на внутренний хост только одного порта публичного хоста того на который внутренний хост уже посылал пакет преимущества nat выполняет три важных функции позволяет сэкономить ip адреса только случае использования nat режиме pat транслируя несколько внутренних ip адресов один внешний публичный ip адрес или несколько но меньшим количеством чем внутренних по такому принципу построено большинство сетей мире на небольшой район домашней сети местного провайдера или на офис выделяется публичный внешний ip адрес за которым работают получают доступ интерфейсы приватными внутренними ip адресами позволяет предотвратить или ограничить обращение снаружи ко внутренним хостам оставляя возможность обращения изнутри наружу при инициации соединения изнутри сети создаётся трансляция ответные пакеты поступающие снаружи соответствуют созданной трансляции поэтому пропускаются если для пакетов поступающих снаружи соответствующей трансляции не существует она может быть созданной при инициации соединения или статической они не пропускаются позволяет скрыть определённые внутренние сервисы внутренних хостов серверов по сути выполняется та же указанная выше трансляция на определённый порт но возможно подменить внутренний порт официально службы например порт tcp http сервер на внешний тем самым снаружи на внешнем ip адресе после трансляции адресов на сайт или форум для осведомлённых посетителей можно будет попасть по адресу но на внутреннем сервере находящемся за nat он будет работать на обычном порту повышение безопасности сокрытие непубличных ресурсов недостатки старые протоколы протоколы разработанные до массового внедрения nat не состоянии работать если на пути между хостами есть трансляция адресов некоторые межсетевые экраны осуществляющие трансляцию ip адресов могут исправить этот недостаток соответствующим образом заменяя ip адреса не только заголовках ip но на более высоких уровнях например командах протокола ftp см application level gateway идентификация пользователей из за трансляции адресов много один появляются дополнительные сложности идентификацией пользователей необходимость хранить полные логи трансляций иллюзия dos атаки если nat используется для подключения многих пользователей одному тому же сервису это может вызвать иллюзию dos атаки на сервис множество успешных неуспешных попыток например избыточное количество пользователей icq за nat приводит проблеме подключением серверу некоторых пользователей из за превышения допустимой скорости подключений частичным решением проблемы является использование пула адресов группы адресов для которых осуществляется трансляция пиринговые сети nat устройствах не поддерживающих технологию universal plug play некоторых случаях необходима дополнительная настройка см трансляция порт адрес при работе пиринговыми сетями некоторыми другими программами которых необходимо не только инициировать исходящие соединения но также принимать входящие пример трансляция локальной сети диапазоном адресов глобальную сеть будет осуществляться через один внешний ip адрес адрес маршрутизатора выполняющего трансляцию применение ip сеть через единственный ip адрес px на рабочих станциях указанный шлюз по умолчанию или gateway файл gateway jpg преобразует служебные заголовки формирует идентичный ip пакет файл ip paket jpg публикация локальных ресурсов во внешней ip сети файл ip set jpg экономическая выгода вследствие приобретения единственного ip подключения не ip сети сокрытие от внешнего наблюдателя структуры внутренней ip сети организация системы распределенной нагрузкой при общем доступе через nat прозрачно открывается доступ внутренней структуре защитой без использования межсетевого экрана через nat корректно работают многие сетевые протоколы конструктивные реализации общий доступ это есть подключение nat есть аппаратная реализация nat интегрированы межсетевые экраны nat loopback смысл технологии nat loopback или nat hairpinning прост если пакет приходит из внутренней сети на внешний ip адрес маршрутизатора он считается пришедшим извне значит работают правила брандмауэра относящиеся ко внешним соединениям если пакет успешно пройдёт сквозь брандмауэр сработает nat взяв на себя посредничество между двумя внутрисетевыми машинами это даёт две вещи прямо изнутри локальной сети можно проверить как настроены сетевые службы доступ серверу находящемуся локальной сети по доменному имени без nat loopback пришлось бы править файл hosts на каждой машине для каждого домена поддомена недостатком nat loopback можно считать повышенную нагрузку на хаб маршрутизатор по сравнению прямым доступом серверу nat traversal nat traversal прохождение или автонастройка nat это набор возможностей позволяющих сетевым приложениям определять что они находятся за устройством обеспечивающим nat узнавать внешний ip адрес этого устройства выполнять сопоставление портов для пересылки пакетов из внешнего порта nat на внутренний порт используемый приложением все это выполняется автоматически пользователю нет необходимости вручную настраивать сопоставления портов или вносить изменения какие либо другие параметры однако существуют меры доверии таким приложениям они получают обширный контроль над устройством появляются потенциальные уязвимости программная реализация nat при наличии уже существующего сервера под управлением серверной ос возможно организовать трансляцию адресов без необходимости закупки дополнительных аппаратных устройств как правило для программной реализации nat требуется наличие по крайней мере двух сетевых адаптеров сервере возможны варианты одним но при наличии trunk vlan все существующие использующиеся серверные ос поддерживают простейшую трансляцию адресов точки зрения гибкости используются операционные системы семейства unix большинство gnu linux bsd системы также opensolaris др во многих из них nat доступен из коробки других возможна реализация за счёт добавления модулей сочетании межсетевыми экранами функциями трансляции адресов ipfw iptables др также nat работает из коробки семействе операционных систем windows server см также прокси сервер port address translation pat application level gateway stun примечания категория tcp ip категория nat