распределение длин пакетов кадров ethernet сети крупного банка статистика собрана за месяца году включены как служебный так рабочий трафик компьютерных сетях термин maximum transmission unit mtu означает максимальный размер полезного блока данных одного пакета который может быть передан протоколом без фрагментации обычно заголовки протокола не входят mtu но некоторых системах некоторых протоколах заголовки могут учитываться когда говорят об mtu обычно имеют виду протокол канального уровня сетевой модели osi однако этот термин может применяться для других уровней media mtu полный кадр mtu hw mtu system mtu ip mtu ip заголовок учитывается mtu routing tcp mss внесистемные tunnel mtu vlan mtu mpls mtu описание таблица основных значений mtu интерфейс значение mtu байт internet path mtu для rfc ethernet ii rfc ethernet llc snap pppoe rfc wlan token ring fddi rfc ограничение на максимальный размер кадра накладывается по нескольким причинам для уменьшения времени на повторную передачу случае потери или неисправимого искажения пакета вероятность потерь растёт увеличением длины пакета чтобы при полудуплексном режиме работы хост не занимал долгое время канал также для этой цели используется чем больше отправляемый пакет тем дольше ждут отправления другие пакеты особенно интерфейсах поэтому маленький mtu был актуален во времена медленных коммутируемых соединений малый размер быстродействие сетевых буферов входящих исходящих пакетов однако слишком большие буферы тоже ухудшают значение mtu определяется стандартом протокола но может быть переопределено автоматически для определённого потока протоколом pmtud или вручную для нужного интерфейса на некоторых интерфейсах mtu по умолчанию может быть установлено ниже максимально возможного значение mtu ограничено снизу как правило минимально допустимой длиной кадра минимальный размер кадра обычно связывают коллизионным доменом полудуплексный канал участники домена должны узнать коллизии до окончания передачи кадра здесь также учитываются ограничения накладываемые стандартом на физические особенности тракта например длина материалы минимальный размер кадра по стандартам fast ethernet base байта gigabit ethernet base байт для сети причины вызвавшие начальные ограничения mtu устарели связи этим для ethernet был разработан стандарт jumbo кадров увеличенным mtu некоторые протоколы например из группы протоколов atm оперируют ячейками фиксированной длины для них нет возможности изменить mtu некоторых случаях этот подход приводит лучшему управлению сетевыми потоками зависимость скорости от mtu зависимость эффективной скорости от длин заголовков mtu ethernet сети на графике предполагается что шейпер работает кадрами длиной до байт не учитывает межкадровый интервал зависимость скорости от задержки на графике не учитывается номинальная скорость битовая скорость передачи данных поддерживаемая на интервале передачи одного пакета без различия служебных заголовков очевидно что чем меньше пакет тем быстрее он передастся эффективная скорость это средняя скорость передачи данных нагрузки потоке этот параметр зависит от соотношения длин служебных заголовков нагрузке во многих случаях некоторый объём информации эффективнее передавать большими пакетами из за меньших накладных расходов корректно сравнивать скорости потоков можно только для одного того же объёма данных который требуется передать единовременно чем больше полезная нагрузка пакета по отношению его заголовкам тем выше скорость передачи полезной информации процент использования канала channel utilization поскольку mtu это верхняя граница длины полезной нагрузки то максимальная скорость достигается когда нагрузки всех пакетов потоке имеют длину равную mtu для шейпинга существуют разные методы подсчёта длины без jumbo до байт тегом на компьютерах общего назначения где шейпер реализован программно заключительные байты называются или footer поля fcs обрабатываются сетевым адаптером операционную систему передаётся пакет без них до байт тегом ethernet пакет включая поле fcs но не учитывая преамбулу до байт тегом на специальных сетевых платформах вместе обычным ethernet заголовком учитывается преамбула fcs межкадровый интервал этот способ подсчёта также нужно использовать когда скорость ограничивается только протоколом передачи данном случае ethernet не ограничивается провайдером существуют несколько способов увеличения пропускной способности контексте длин пакетов уменьшение межкадрового интервала для fast ethernet он по умолчанию равен мкс за который могло бы быть передано байт некоторые сетевые адаптеры полнодуплексном режиме могут передавать получать кадры уменьшенным межкадровым интервалом сжатие заголовков пример реализации метод сжатия заголовков tcp ip якобсона сжатие нагрузки низкого уровня пример реализации ip payload compression protocol решение проблемы передачи небольших данных tinygram problem за счёт придерживания буфере малых данных чтобы отправить один большой пакет пример реализации алгоритм нейгла частный случай этой проблемы болтливые протоколы посылающие множество запросов там где можно обойтись одним существуют программные аппаратные решения осуществляющие оптимизацию таких соединений например компании известные проблемы хост знает значение mtu для собственного возможно своих соседей интерфейса но минимальное значение mtu для всех узлов сети обычно неизвестно другая потенциальная проблема заключается том что протоколы более высокого уровня могут создавать пакеты большего размера не поддерживаемые другими узлами сети прохождение больших пакетов по сети фрагментацией для устранения этих проблем ip поддерживает фрагментацию что позволяет разбивать дейтаграмму на меньшие кусочки каждый из которых будет достаточно мал чтобы пройти через узел из за которого происходит фрагментация фрагменты пакетов маркируются таким образом чтобы ip целевого хоста мог произвести сборку фрагментов оригинальную дейтаграмму фрагментация пакетов имеет свои недостатки целевой хост должен получить все фрагменты для того чтобы собрать пакет если хотя бы один фрагмент утерян весь пакет должен быть отправлен заново как правило фрагментацию выполняют более медленные процессоры нежели те что обрабатывают транзитный трафик некоторых случаях задержки которые вызовет фрагментация всех пакетов могут быть сочтены неприемлемыми увеличивается нагрузка на процессоры промежуточных маршрутизаторов машины адресата увеличивается требование памяти маршрутизатора необходимо хранить буфере все фрагменты ip пакета некоторые межсетевые экраны могут блокировать фрагменты из за копии ip заголовка для каждого фрагмента неэффективно используется полоса пропускания протоколам маршрутизации например ospf требуется согласованный mtu для корректной работы для обозначения кадров которые имеют ненормативный размер сетях ethernet применяются следующие термины runt коротышка кадр размер которого менее байтов бит long длинный кадр размер которого лежит пределах от до байтов giant гигант кадр размер которого превышает байтов path mtu discovery термин path mtu означает наименьший mtu на пути следования пакета сети хотя фрагментация решает проблему несоответствия размеров пакетов значения mtu она ощутимо снижает сетевых устройств связи этим году была предложена альтернативная технология названная path mtu discovery rfc суть технологии заключается том что при соединении двух хостов устанавливается параметр df don fragment не фрагментировать который запрещает фрагментацию пакетов это приводит тому что узел значение mtu которого меньше размера пакета отклоняет передачу пакета отправляет сообщение icmp необходима фрагментация но установлен флаг её запрета df хост отправитель уменьшает размер пакета отсылает его заново такая операция происходит до тех пор пока пакет не будет достаточно мал чтобы дойти до хоста получателя без фрагментации однако этой технологии существуют потенциальные проблемы некоторые маршрутизаторы настраиваются на полное блокирование icmp пакетов это не очень грамотно но может быть самым простым решением нескольких проблем безопасности результате если размер пакета не соответствует значению mtu на определённом участке пакет отбрасывается хост отправитель не может получить информацию значении mtu не отправляет пакет заново поэтому соединение между хостами не устанавливается проблема получила название mtu discovery black hole rfc протокол был модифицирован для детектирования таких маршрутизаторов одной из проблем при работе сети блокирующей icmp пакеты является работа irc когда пользователь успешно проходит авторизацию но не может получить так называемое motd message of the day результате чего использование сети не представляется возможным проблема представляет потенциальную опасность для любого pppoe соединения использующего mtu меньше типового байт существует несколько вариантов решения этой проблемы самым простым безусловно является отмена фильтрации пакетов icmp однако зачастую подобная операция находится вне компетенции пользователя поэтому проблему решают путём ручной настройки размера передаваемого пакета на шлюзе пользователя для этого меняют значение mss максимальный размер сегмента то есть величина меньшая mtu на байт случае протокола ipv при установке соединения хосты обмениваются информацией максимальном размере сегмента который каждый из них сможет принять поэтому меняя значение mss заставляют оба хоста обмениваться пакетами которые шлюз пользователя сможет заведомо принять без фрагментации кроме того существуют методы отмены бита df целью разрешения фрагментации однако метод корректировки mss является маршрутизаторах cisco реализация pmtud для туннеля поддерживает только tcp пакеты см также maximum receive unit mru максимальный размер полезного блока данных протокола ppp maximum segment size mss максимальный размер полезного блока данных tcp сегмента pdu общий блок данных протокола полезные данные заголовки альтернативное не всегда корректное определение весь блок данных определённого уровня сетевой модели sdu терминологии osi блок данных который прошёл со своего уровня на нижний уровень модели ещё не был инкапсулирован pdu этого уровня примечания ссылки drtcp утилита для оптимизации mtu microsoft windows mturoute консольная утилита для устранения проблем mtu разъяснение mtu различных уровней на примере mikrotik os resolve ip fragmentation mtu mss and pmtud issues with gre and ipsec категория параметры компьютерных сетей категория сетевые пакеты категория компьютерных сетей