arp протокол определения адреса протокол компьютерных сетях предназначенный для определения mac адреса имея ip адрес другого компьютера рассмотрим суть arp на простом примере компьютер ip адрес компьютер ip адрес соединены сетью ethernet компьютер желает переслать пакет данных на компьютер ip адрес компьютера ему известен однако сеть ethernet которой они соединены не работает ip адресами поэтому компьютеру для осуществления передачи через ethernet требуется узнать адрес компьютера сети ethernet mac адрес терминах ethernet для этой задачи используется протокол arp по этому протоколу компьютер отправляет запрос адресованный всем компьютерам одном ним домене суть запроса компьютер ip адресом сообщите свой mac адрес компьютеру мас адресом напр ea сеть ethernet доставляет этот запрос всем устройствам том же сегменте ethernet том числе компьютеру компьютер отвечает компьютеру на запрос сообщает свой mac адрес напр ea теперь получив mac адрес компьютера компьютер может передавать ему любые данные через сеть ethernet наибольшее распространение arp получил благодаря повсеместности сетей ip построенных поверх ethernet поскольку практически случаев при таком сочетании используется arp семействе протоколов ipv arp не существует его функции возложены на icmpv описание описание протокола было опубликовано ноябре года rfc arp был спроектирован для случая передачи ip пакетов через кадры ethernet при этом общий принцип предложенный для arp может был использован для сетей других типов существуют следующие типы сообщений arp запрос arp arp request ответ arp arp reply система отправитель при помощи запроса arp запрашивает физический адрес системы получателя ответ физический адрес узла получателя приходит виде ответа arp перед тем как передать пакет сетевого уровня через сегмент ethernet сетевой стек проверяет кэш arp чтобы выяснить не ли нём уже нужная информация об узле получателе если такой записи кэше arp нет то выполняется запрос arp этот запрос для устройств сети имеет следующий смысл кто нибудь знает физический адрес устройства обладающего следующим ip адресом когда получатель этим ip адресом примет этот пакет то должен будет ответить да это мой ip адрес мой физический адрес следующий после этого отправитель обновит свой кэш arp будет способен передать информацию получателю ниже приведён пример запроса ответа arp записи кэше arp могут быть статическими динамическими пример данный выше описывает динамическую запись кэша можно также создавать статические записи таблице arp это можно сделать при помощи команды arp системах семейства windows до nt записи таблице arp созданные динамически остаются кэше течение минут если течение этих двух минут произошла повторная передача данных по этому адресу то время хранения записи кэше продлевается ещё на минуты эта процедура может повторяться до тех пор пока запись кэше просуществует до минут после этого запись будет удалена из кэша будет отправлен повторный запрос arp сейчас же время хранения записей arp таблице метод хранения выбираются программно при желании их можно изменить вариации arp протокола arp изначально был разработан не только для ip протокола но настоящее время основном используется для сопоставления ip mac адресов arp также можно использовать для разрешения mac адресов для различных адресов протоколов го уровня layer protocols addresses arp был адаптирован также для разрешения других видов адресов го уровня layer addresses например atmarp используется для разрешения atm nsap адресов classical ip over atm протоколе inverse arp inverse address resolution protocol inverse arp или inarp протокол для получения адресов сетевого уровня например ip адресов других рабочих станций по их адресам канального уровня например dlci frame relay сетях основном используется во frame relay atm сетях сравнение arp inarp arp переводит адреса сетевого уровня адреса канального уровня то же время inarp можно рассматривать как его инверсию inarp реализовано как расширение arp форматы пакетов этих протоколов одни те же различаются лишь коды операций заполняемые поля reverse arp rarp как inarp переводит адреса канального уровня адреса сетевого уровня но rarp используется для получения логических адресов самих станций отправителей то время как inarp протоколе отправитель знает свои адреса запрашивает логический адрес другой станции от rarp отказались пользу bootp который был свою очередь заменён dhcp принцип работы узел которому нужно выполнить отображение ip адреса на локальный адрес формирует arp запрос вкладывает его кадр протокола канального уровня указывая нем известный ip адрес рассылает запрос все узлы локальной сети получают arp запрос сравнивают указанный там ip адрес собственным случае их совпадения узел формирует arp ответ котором указывает свой ip адрес свой локальный адрес отправляет его уже направленно так как arp запросе отправитель указывает свой локальный адрес преобразование адресов выполняется путём поиска таблице эта таблица называемая arp таблицей хранится памяти содержит строки для каждого узла сети двух столбцах содержатся ip ethernet адреса если требуется преобразовать ip адрес ethernet адрес то ищется запись соответствующим ip адресом ниже приведен пример упрощённой arp таблицы ac структура пакета ниже структура пакета используемого запросах ответах arp сетях ethernet этих пакетах используется ethertype запросы рассылаются на mac адрес ff ff ff ff ff ff отметим что структуре пакета показанной ниже качестве sha spa tha tpa условно используются битные слова реальная длина определяется физическим устройством протоколом bits hardware type htype protocol type ptype hardware length hlen protocol length plen operation oper sender hardware address sha sender protocol address spa target hardware address tha target protocol address tpa hardware type htype каждый канальный протокол передачи данных имеет свой номер который хранится этом поле например ethernet имеет номер protocol type ptype код сетевого протокола например для ipv будет записано hardware length hlen длина физического адреса байтах адреса ethernet имеют длину байт protocol length plen длина логического адреса байтах ipv адреса имеют длину байта operation код операции отправителя случае запроса случае ответа sender hardware address sha физический адрес отправителя sender protocol address spa логический адрес отправителя target hardware address tha физический адрес получателя поле пусто при запросе target protocol address tpa логический адрес получателя пример запроса arp request если хост ipv адресом mac адресом хочет послать пакет другому хосту адресом но не знает его mac адрес то он должен послать arp запрос для разрешения адреса пакет изображённый ниже изображает запрос если хост ip присутствует сети доступен то он получает этот запрос arp возвращает ответ bits hardware type protocol type hardware length protocol length operation sha first bits sha last bits spa first bits spa last bits tha first bits tha last bits tpa пример ответа ситуации описанной выше если узел адресом имеет mac адрес aa то он отправит ответ пакет ниже заметим что блоки адресов отправителя получателя теперь поменяли значения отправитель ответа теперь получатель запроса получатель ответа отправитель запроса кроме того ответе есть mac адрес узла поле физического адреса отправителя sha любой узел той же сети что отправитель получателем тоже получит запрос так как он таким образом добавит свой кэш информацию об отправителе ответ arp направлен только источнику запроса arp поэтому ответ arp не доступен другим узлам сети bits hardware type protocol type hardware length protocol length operation sha first bits sha last bits aa spa first bits spa last bits tha first bits tha last bits tpa замечание длина полей sha spa tha tpa зависит от параметров hardware length protocol length соответственно кэш arp эффективность arp во многом зависит от кэша arp arp cache который присутствует на каждом хосте кэше содержатся ip адреса соответствующие им аппаратные адреса время жизни записи кэше оставлено на усмотрение разработчика по умолчанию может составлять от десятков секунд например секунд до четырёх часов cisco ios обнаружение конфликтов адресов address conflict detection протокол arp может использоваться для обнаружения конфликтов ip адресов локальной сети rfc определяет формат запроса arp probe полем spa состоящим из всех нулей ip адрес перед использованием ip адреса хост может проверить что данный ip адрес не используется другим хостом сегмента локальной сети arp оповещение arp оповещение arp announcement это пакет обычно arp запрос содержащий корректную sha spa хоста отправителя tpa равной spa это не разрешающий запрос запрос на обновление arp кэша других хостов получающих пакет большинство операционных систем посылает такой пакет при включении хоста сеть что позволяет предотвратить ряд проблем например при смене сетевой карты когда необходимо обновить связь между ip mac адресами такой запрос исправит записи arp кэше других хостов сети arp оповещения также используются для защиты ip адресов rfc zeroconf протоколе arp запросы могут решать другие задачи так при загрузке сетевого обеспечения эвм такой запрос может выяснить не присвоен ли идентичный ip адрес какому то еще объекту сети рамках протокола arp возможны самообращённые запросы gratuitous arp при таком запросе инициатор формирует пакет где качестве ip адреса используется его собственный адрес это бывает нужно когда осуществляется стартовая конфигурация сетевого интерфейса таком запросе ip адреса отправителя получателя совпадают самообращённый запрос позволяет эвм решить две проблемы во первых определить нет ли сети объекта имеющего тот же iр адрес если на такой запрос придёт отклик то эвм выдаст на консоль сообщение duplicate ip address sent from ethernet address во вторых случае смены сетевой карты производится корректировка записи аrp таблицах эвм которые содержали старый мас адрес инициатора машина получающая arp запрос адресом который содержится её таблице должна обновить эту запись вторая особенность такого запроса позволяет резервному файловому серверу заменить основной послав самообращённый запрос со своим мас адресом но ip адресом вышедшего из строя сервера этот запрос вызовет перенаправление кадров адресованных основному серверу на резервный клиенты сервера при этом могут не знать выходе основного сервера из строя при этом возможны неудачи если программные реализации эвм не полной мере следуют регламентациям протокола arp примечания см также mac адрес ip адрес dhcp rarp bootp arp spoofing proxy arp ссылки arp sequence diagram pdf rfc address resolution protocol rfc inverse address resolution protocol rfc ipv address conflict detection gratuitous arp free arp tools with source code french arp sk arp traffic generation tools arp спуфинг русский очистить кэш arp linux категория протоколы канального уровня