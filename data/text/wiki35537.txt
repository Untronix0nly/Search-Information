xmlhttprequest xmlhttp xhr api доступный скриптовых языках браузеров таких как javascript использует запросы http или https напрямую веб серверу загружает данные ответа сервера напрямую вызывающий скрипт информация может передаваться любом текстовом формате например xml html или json позволяет осуществлять http запросы серверу без перезагрузки страницы xmlhttp является важной составляющей технологии ajax asynchronous javascript and xml используется многими сайтами для создания динамичных быстро реагирующих на запросы пользователя приложений например xmlhttp используется такими сайтами как bing maps gmail google maps google suggest facebook xmlhttp работает только файлами находящимися на том же домене что использующая xmlhttp страница но существует возможность обойти ограничение как случае javascript эта возможность обойти ограничение сделана целях безопасности cross site scripting хотя названии присутствует аббревиатура xml технология не накладывает ограничений на формат передаваемых данных данные можно пересылать как виде xml так json html или просто текстом разработчик может самостоятельно создать формат для передачи данных однако нужно учитывать что при пересылке используется текстовый протокол http потому при использовании метода get данные должны передаваться виде текста то есть бинарные данные следует кодировать примеру base при использовании метода post кодировании нет необходимости история впервые был разработан компанией microsoft появившись компоненте outlook web access программного продукта microsoft exchange server он был назван ixmlhttprequest позднее наработки были включены состав msxml виде объекта activex доступного через jscript vbscript или другие скриптовые языки браузером msxml был включён состав браузера internet explorer программисты проекта mozilla затем разработали совместимую версию называющуюся mozilla доступ компоненту был реализован через javascript объект названный xmlhttprequest однако полной удалось добиться только mozilla дальнейшем поддержка xmlhttprequest появилась браузерах safari opera других последняя официальная спецификация версия xmlhttprequest от декабря года которая имеет статус текущего стандарта living standard версия xmlhttprequest level от января года имеющая статус рабочего варианта во второй версии вводятся обработчики событий прогресса поддержка кросс доменных запросов работа бинарными данными методы класса xmlhttprequest метод описание abort отменяет текущий запрос удаляет все заголовки ставит текст ответа сервера null возвращает полный список http заголовков виде строки заголовки разделяются знаками переноса cr lf если флаг ошибки равен true возвращает пустую строку если статус или вызывает ошибку headername возвращает значение указанного заголовка если флаг ошибки равен true возвращает null если заголовок не найден возвращает null если статус или вызывает ошибку open method url async username password определяет метод url другие опциональные параметры запроса параметр async определяет происходит ли работа асинхронном режиме последние два параметра необязательны send content отправляет запрос на сервер label value добавляет http заголовок запросу mimetype позволяет указать mime type документа если сервер его не передал или передал неправильно внимание метод отсутствует internet explorer свойства класса xmlhttprequest свойство тип описание eventlistener обработчик события которое происходит при каждой смене состояния объекта имя должно быть записано нижнем регистре readystate unsigned short текущее состояние объекта не инициализирован открыт отправка данных получение данных данные загружены responsetext domstring текст ответа на запрос если состояние не или возвращает пустую строку responsexml document текст ответа на запрос виде xml который затем может быть обработан посредством dom если состояние не возвращает null status unsigned short http статус виде числа not found ok statustext domstring статус виде строки not found ok если статус не распознан браузер пользователя должен вызвать ошибку ошибки вызываемые классом xmlhttprequest название код описание security_err вызывается при попытке совершить запрос запрещённый настройками безопасности браузере пользователя network_err вызывается при ошибке сети во время синхронного запроса abort_err вызывается при прерывании пользователем запроса во время синхронного запроса пример использования план работы объектом xmlhttprequest можно представить следующим образом создание экземпляра объекта xmlhttprequest открытие соединения установка обработчика события нужно делать после открытия до отправки ie отправка запроса создание экземпляра объекта xmlhttprequest на этой стадии необходима отдельная реализация для разных браузеров конструкция создания объекта отличается ie ie она реализована через activexobject остальных браузерах ie выше mozilla opera chrome netscape safari как встроенный объект типа xmlhttprequest вызов для ранних версий internet explorer выглядит так var req new activexobject microsoft xmlhttp остальных браузерах var req new xmlhttprequest то есть для обеспечения кросс браузерности кода нужно лишь проверять наличие объектов window xmlhttprequest window activexobject зависимости от того какой есть тот применять качестве универсального решения предлагается использование такой функции function if typeof xmlhttprequest undefined xmlhttprequest function try return new activexobject msxml xmlhttp catch try return new activexobject msxml xmlhttp catch try return new activexobject msxml xmlhttp catch try return new activexobject microsoft xmlhttp catch throw new error this browser does not support xmlhttprequest return new xmlhttprequest установка обработчика событий открытие соединения отправка запросов эти вызовы выглядят так req open req где метод запроса допускаются delete get head options post put адрес запроса флаг определяющий использовать ли асинхронный запрос по умолчанию установлен true логин пароль соответственно указываются при необходимости после определения всех параметров запроса его остается только отправить делается это методом send при отправке get запроса для версии без activex необходимо указать параметр null остальных случаях можно не указывать никаких параметров не будет ошибкой если для get всегда будет указан параметр null req send null после этого начинает работать вышеуказанный обработчик событий он фактически основная часть программы обработчике обычно происходит перехват всех возможных кодов состояния запроса вызов соответствующих действий также перехват возможных ошибок пример кода этими двумя функциями var req function loadxmldoc url req null if window xmlhttprequest try req new xmlhttprequest catch else if window activexobject try req new activexobject msxml xmlhttp catch try req new activexobject microsoft xmlhttp catch if req req open get url true req req send null function try важно только при состоянии complete if req readystate для статуса ok if req status обработка ответа else alert не удалось получить данные req statustext catch alert ошибка description связи багом xmlhttprequest firefox приходится отлавливать ошибку bugzilla bug xmlhttprequest needs way to report networking errors https bugzilla mozilla org show_bug cgi id известные проблемы малый размер буфера при загрузке видео см также ajax http rest примечания литература ссылки история история xmlhttp глазами одного из разработчиков реализация браузерах apple safari kde konqueror microsoft ixmlhttprequest mozilla mozilla xmlhttprequest object howto mozilla xml extras opera для компьютеров для мобильных телефонов учебные руководства xmlhttprequest описание применение частые проблемы сверхдинамичные веб интерфейсы стандарты создана рабочая группа по стандартизации xmlhttprequest во всех браузерах категория microsoft категория javascript категория xml категория протокол http категория ajax категория статьи примерами кода javascript