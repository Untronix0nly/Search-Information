ntp протокол сетевого времени сетевой протокол для синхронизации внутренних часов компьютера использованием сетей переменной латентностью протокол был разработан профессором делавэрского университета году версия на год ntpv ntp основанный на алгоритме марзулло использует для своей работы протокол udp учитывает время передачи система ntp чрезвычайно устойчива изменениям латентности среды передачи версии способен достигать точности мс при работе через интернет до мс лучше внутри локальных сетей наиболее широкое применение протокол ntp находит для синхронизации серверов точного времени для достижения максимальной точности предпочтительна постоянная работа программного обеспечения ntp режиме системной службы семействе операционных систем microsoft windows это служба time linux демон ntpd или chronyd более простая реализация этого алгоритма известна как sntp простой протокол сетевого времени используется во встраиваемых системах устройствах не требующих высокой точности также программах точного времени структура пакета структура пакета описана пакет состоит из целого числа битных слов данные заголовке будут отличаться для различных режимов работы например клиент поля часовой слой идентификатор источника начальное время время приёма должен записать нули заголовок заголовок ntp отступ октет октет бит ик версия режим часовой слой интервал опроса точность задержка дисперсия идентификатор источника время обновления начальное время время приёма время отправки индикатор коррекции пример синхронизации времени используя ntp длина бита от целое число показывающее предупреждение секунде координации значение описание нет предупреждения последняя минута дня содержит секунду последняя минута дня содержит секунд неизвестно время не номер версии длина бита от целое число представляющее версию протокола режим длина бита от целое число представляющее режим значения представлены таблице ниже значение описание зарезервировано симметричный активный режим симметричный пассивный режим клиент сервер режим контрольное сообщение ntp зарезервировано для частного использования часовой слой длина бит от целое число представляющее часовой слой значение описание не определено или недопустим первичный сервер вторичный сервер использующий ntp не зарезервировано интервал опроса длина бит от целое число со знаком представляющее максимальный интервал между сообщениями значение равно двоичному логарифму секунд предлагаемые по умолчанию пределы на минимальные максимальные опросы соответственно точность длина бит от целое число со знаком представляющее точность системных часов значение равно двоичному логарифму секунд например значению будет соответствовать точность около мкс задержка длина бита от общее время распространения сигнала обе стороны коротком формате ntp дисперсия длина бита от общая дисперсия для источника времени коротком формате ntp идентификатор источника длина бита от код источника синхронизации зависит от значения поле часовой слой для слоя это четыре ascii символа называемые kiss code используются для отладки мониторинга смотри ниже для слоя это четыре октета ascii символов дополненные слева нулями назначенные для опорного времени таблице ниже представлен список поддерживаемый iana id источник goes геостационарный спутник системы экологического мониторинга наблюдения gps система глобального gal система галилео pps irig сша wwvb колорадо сша dcf низкочастотный радиопередатчик кгц dcf майнфлинген фрг hbg швейцария msf великобритания jjy япония lorc среднечастотный радиопередатчик кгц радионавигация tdf франция chu канада wwv сша wwvh сша nist телефонный модем национального института стандартов технологий сша acts телефонный модем национального института стандартов технологий сша usno телефонный модем национальной обсерватории сша ptb телефонный модем для слоя выше это идентификатор сервера может быть использован для фиксирования временных петель если используется ipv то идентификатор представляет из себя четыре октета ip адреса если используется ipv то это первые четыре октета md хэша адреса стоит отметить что при использовании ipv адресов для сервера ntpv клиента ntpv идентификатор может принимать случайное значение из за чего временные петли могут быть не зафиксированы время обновления длина бита от время когда система последний раз устанавливала или корректировала время формат ntp начальное время длина бита от время клиента когда запрос отправляется серверу формат ntp время приёма длина бита от время сервера когда запрос приходит от клиента формат ntp время отправки длина бита от время сервера когда запрос отправляется клиенту формат ntp ntp сообщение kiss death для слоя который считается неопределённым или недопустимым поле идентификатор источника может использоваться для доставки сообщений которые выполняют роль данных состоянии системы управления доступом такие сообщения называются kiss death kod доставляемые ими ascii данные называются kiss codes коды помощи перечень принятых настоящее время кодов помощи представлен таблице ниже получатели kod сообщений обязаны их проверить выполнить следующие действия при получении кодовых комбинаций deny rstr клиент обязан разорвать виртуальные соединения данным сервером времени прекратить передачу сообщений этому серверу при получении кодовой комбинации rate клиент обязан незамедлительно снизить свой интервал опроса этого сервера продолжать его уменьшать каждый раз при получении этой кодовой комбинации при получении кодовой комбинации начинающейся ascii символа предназначенной для проведения исследований последующих она должна быть проигнорирована если она не распознаётся все другие кодовые комбинации kod сообщения не определённые данным протоколом уничтожаются после их поверки коды помощи код описание acst виртуальное соединение установлено одноадресным сервером auth аутентификация сервером завершилась отказом auto autokey некорректна bcst виртуальное соединение установлено сервером cryp аутентификация или идентификация завершились отказом deny удалённый сервер отказал доступе drop потеря удаленного сервера времени симметричном режиме rstr отказ доступе вследствие локальной стратегии безопасности init виртуальное соединение первого раза не установлено mcst виртуальное установлено динамически обнаруженным сервером nkey ключ не найден либо он никогда ранее не загружался либо он является ненадёжным rate скорость превышена сервер временно запретил доступ так как клиент превысил порог скорости rmot изменение виртуального соединения со стороны удалённого ip узла использующего ntp протокол напрямую step произошла итерация по изменению системного времени виртуальное не установлено часовые слои жёлтые стрелки обозначают аппаратное соединение красные стрелки обозначают сетевое соединение ntp использует иерархическую сеть где каждый уровень имеет свой номер называемый слой слой первичные серверы непосредственно национальными службами времени через спутник радио или телефонный модем слой вторичные серверы первичными серверами как правило клиенты серверы ntp относительно небольшим числом клиентов не первичными серверами существует несколько сотен общественных вторичных серверов работающих на более высоких слоях они являются выбором формат времени время представляется системе ntp битным числом байт состоящим из битного счётчика секунд битного счётчика долей секунды позволяя передавать время диапазоне секунд теоретической точностью секунды поскольку шкала времени ntp повторяется каждые секунды лет получатель должен хотя бы примерно знать текущее время точностью лет также следует учитывать что время отсчитывается полуночи января года не поэтому из времени ntp нужно вычитать лет учётом високосных лет чтобы корректно совместить время windows или unix системами короткий формат времени бит секунды доли секунд обычный формат времени бит секунды доли секунд формат даты бит номер эры отступ эры доли см также служба точного времени дисперсия аллана openntpd синхронизация часов протокол точного времени заметки примечания литература миллс дэвид сличение времени компьютерных сетях протокол сетевого времени на земле космосе киев wircom isbn другие версии rfc rfc rfc rfc rfc rfc rfc rfc ссылки категория протоколы прикладного уровня категория интернет протоколы категория часы