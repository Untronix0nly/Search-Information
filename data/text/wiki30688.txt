can сеть контроллеров стандарт промышленной сети ориентированный прежде всего на объединение единую сеть различных исполнительных устройств датчиков режим передачи пакетный can разработан компанией robert bosch gmbh середине настоящее время широко распространён промышленной автоматизации технологиях умного дома автомобильной промышленности многих других областях стандарт для автомобильной автоматики описание стандарта непосредственно стандарт can компании bosch определяет передачу отрыве от физического уровня он может быть каким угодно например радиоканалом или оптоволокном но на практике под can сетью обычно подразумевается сеть топологии шина физическим уровнем виде пары определённым стандарте iso передача ведётся кадрами которые принимаются всеми узлами сети для доступа шине выпускаются микросхемы драйверы can шины общие сведения can является синхронной шиной типом доступа collision resolving cr разрешение коллизии который отличие от collision detect cd обнаружение коллизии сетей ethernet детерминировано приоритетно обеспечивает доступ на передачу сообщения что особо ценно для промышленных сетей управления fieldbus передача ведётся кадрами полезная информация кадре состоит из идентификатора длиной бит стандартный формат или бит расширенный формат надмножество предыдущего поля данных длиной от до байт идентификатор говорит содержимом пакета служит для определения приоритета при попытке одновременной передачи несколькими сетевыми узлами рецессивные доминантные биты для абстрагирования от среды передачи спецификация can избегает описывать двоичные значения как вместо этого применяются термины рецессивный доминантный при этом подразумевается что при передаче одним узлом сети рецессивного бита другим доминантного принят будет доминантный бит например при реализации физического уровня на радиоканале отсутствие сигнала означает рецессивный бит наличие доминантный тогда как типичной реализации проводной сети рецессив бывает при наличии сигнала доминант соответственно при отсутствии стандарт сети требует от физического уровня фактически единственного условия чтобы доминантный бит мог подавить рецессивный но не наоборот например оптическом волокне доминантному биту должен соответствовать свет рецессивному темнота электрическом проводе может быть так рецессивное состояние высокое напряжение на линии от источника большим внутренним сопротивлением доминантное низкое напряжение доминантный узел сети подтягивает линию на землю если линия находится рецессивном состоянии перевести её доминантное может любой узел сети включив свет оптоволокне или закоротив высокое напряжение наоборот нельзя включить темноту нельзя виды кадров кадр данных data frame передаёт данные кадр удаленного запроса remote frame служит для запроса на передачу кадра данных тем же идентификатором кадр перегрузки overload frame обеспечивает промежуток между кадрами данных или запроса кадр ошибки error frame передаётся узлом обнаружившим сети ошибку кадры данных запроса отделяются от предыдущих кадров межкадровым промежутком формат кадра базовый формат кадра данных поле длина битах описание начало кадра сигнализирует начало передачи кадра идентификатор уникальный идентификатор запрос на передачу rtr должен быть доминантным бит расширения идентификатора ide должен быть доминантным определяет длину идентификатора бит резерв длина данных dlc длина поля данных байтах поле данных байт передаваемые данные длина поле dlc контрольная сумма crc контрольная сумма всего кадра разграничитель контрольной суммы должен быть рецессивным промежуток подтверждения ack передатчик шлёт рецессивный приёмник вставляет доминанту разграничитель подтверждения должен быть рецессивным конец кадра eof должен быть рецессивным первые бит идентификатора не должны быть все рецессивными расширенный формат кадра данных поле длина битах описание начало кадра сигнализирует начало передачи кадра идентификатор первая часть идентификатора подмена запроса на передачу srr должен быть рецессивным бит расширения идентификатора ide должен быть рецессивным определяет длину идентификатора идентификатор вторая часть идентификатора запрос на передачу rtr должен быть доминантным биты резерв длина данных dlc длина поля данных байтах поле данных байт передаваемые данные длина поле dlc контрольная сумма crc контрольная сумма всего кадра разграничитель контрольной суммы должен быть рецессивным промежуток подтверждения ack передатчик шлёт рецессивный приёмник вставляет доминанту разграничитель подтверждения должен быть рецессивным конец кадра eof должен быть рецессивным идентификатор получается объединением частей формат кадра удаленного запроса совпадает кадрами данных стандартного или расширенного формата за двумя исключениями поле rtr рецессив вместо доминанты отсутствует поле данных арбитраж доступа при свободной шине любой узел может начинать передачу любой момент случае одновременной передачи кадров двумя более узлами проходит арбитраж доступа передавая идентификатор узел одновременно проверяет состояние шины если при передаче рецессивного бита принимается доминантный считается что другой узел передаёт сообщение большим приоритетом передача откладывается до освобождения шины таким образом отличие например от ethernet can не происходит потери пропускной способности канала при коллизиях цена этого решения возможность того что сообщения низким приоритетом никогда не будут переданы контроль ошибок can имеет несколько механизмов контроля предотвращения ошибок контроль передачи при передаче битовые уровни сети сравниваются передаваемыми битами дополняющие биты bit stuffing после передачи пяти одинаковых битов подряд автоматически передаётся бит значения таким образом кодируются все поля кадров данных или запроса кроме разграничителя контрольной суммы промежутка подтверждения eof контрольная сумма передатчик вычисляет её добавляет передаваемый кадр приёмник считает контрольную сумму принимаемого кадра реальном времени одновременно передатчиком сравнивает суммой самом кадре случае совпадения передаёт доминантный бит промежутке подтверждения контроль значений полей при приёме разработчики оценивают вероятность невыявления ошибки передачи как скорость передачи длина сети диапазон скоростей все узлы сети должны работать одной скоростью стандарт can не определяет скоростей работы но большинство как отдельных так встроенных адаптеров позволяют плавно менять скорость диапазоне по крайней мере от килобит секунду до мегабита секунду существуют решения выходящие далеко за рамки данного диапазона предельная длина сети приведённые выше методы контроля ошибок требуют чтобы изменение бита при передаче успело по всей сети моменту замера значения это ставит максимальную длину сети обратную зависимость от скорости передачи чем больше скорость тем меньше длина например для сети стандарта iso предельные длины составляют приблизительно мбит кбит кбит кбит использование оптопар для защиты устройств от высоковольтных помех сети ещё больше сокращает предельную длину тем больше чем больше задержка сигнала оптопаре сильно разветвлённые сети паутина также снижают скорость из за множества отражений сигнала большей электрической ёмкости шины протоколы высокого уровня базовой спецификации can недостаёт многих возможностей требуемых реальных системах передачи данных длиннее байт автоматического распределения идентификаторов между узлами единообразного управления устройствами различных типов производителей поэтому вскоре после появления can на рынке начали разрабатываться протоколы высокого уровня для него число на данный момент протоколов входят canopen devicenet can kingdom sds nmea морской транспорт arinc авиация uavcan робототехника летательные аппараты применение can во всех системах современного автомобиля применяется can протокол для связи эбу дополнительными устройствами контроллерами исполнительных механизмов различных систем безопасности некоторых автомобилях can связывает immo приборные панели srs блоки также протокол can iso вошел состав стандарта obd ii преимущества недостатки преимущества возможность работы режиме жёсткого реального времени простота реализации минимальные затраты на использование высокая устойчивость помехам арбитраж доступа сети без потерь пропускной способности надёжный контроль ошибок передачи приёма широкий диапазон скоростей работы большое распространение технологии наличие широкого ассортимента продуктов от различных поставщиков недостатки небольшое количество данных которое можно передать одном пакете до байт большой размер служебных данных пакете по отношению полезным данным отсутствие единого общепринятого стандарта на протокол высокого уровня однако же это достоинство стандарт сети предоставляет широкие возможности для практически безошибочной передачи данных между узлами оставляя разработчику возможность вложить этот стандарт всё что туда сможет поместиться этом отношении can подобен простому электрическому проводу туда можно затолкать любой поток информации который сможет выдержать пропускная способность шины известны примеры передачи звука изображения по шине can россия известен случай создания системы аварийной связи вдоль автодороги длиной несколько десятков километров германия первом случае нужна была большая скорость передачи небольшая длина линии во втором случае наоборот изготовители как правило не афишируют как именно они используют полезные байты пакете см также fms ссылки canopen special interest group международная организация can in automation официальный сайт ассоциации can kingdom odva сайт ассоциации разработчика devicenet литература по can от производителя can совместимых устройств автомобильные can адаптеры автомобильный стандарт lin протокол can тур категория промышленная автоматика категория промышленные сети