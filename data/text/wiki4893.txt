hpfs аббр от файловая система разработанная специалистами microsoft ibm на основе опыта ibm по созданию файловых систем mvs vm виртуального метода доступа со стороны microsoft проектом руководил опытный системный программист впервые поддержка hpfs появилась операционной системе os версии тех пор штатная поддержка hpfs присутствует во всех версиях os windows nt поддержка hpfs существовала до версии включительно хотя есть успешные прецеденты использования старого драйвера hpfs windows nt даже windows впоследствии microsoft отказалась от hpfs пользу собственной файловой системы ntfs при разработке которой был учтён опыт создания hpfs os существует серверный вариант драйвера для hpfs называемый hpfs который обладает некоторыми дополнительными возможностями структура диск hpfs делится на сектора фиксированного размера байт текущей реализации при этом номер сектора или их количество кодируются во внутренних структурах как байтовое беззнаковое целое что позволяет адресовать диски размером до терабайта начале диска расположены несколько управляющих блоков загрузочный сектор dos овского вида superblock содержит информацию геометрии диска указатели на битовые карты битмапы от свободного пространства указатель на корневой каталог размер дисковой полосы номер полосы каталогами указатель на список сбойных блоков superblock также содержит дату последнего запуска chkdsk обычно изменяют superblock только программы chkdsk spareblock содержит указатели на пул hotfix areas пул fault tolerance областей только hpfs использует fault tolerance пул блоков для операций на почти переполненном диске другие указатели флаги дескрипторы область начальной загрузки область секторов используемых временно для выполнения операций требующих дополнительную дисковую память эта область например иногда задействуется при переименовании файла на заполненном диске другие области для определения того свободен сектор или занят hpfs использует битовые карты которых каждый бит соответствует одному сектору если бит содержит это означает что сектор занят иначе он свободен если бы на весь диск была только одна битовая карта то для её подкачки приходилось бы перемещать головки чтения записи среднем через половину диска чтобы избежать этого hpfs разбивает диск на полосы или группы от длиной по мегабайт хранит битмапы свободных секторов начале или конце каждой полосы при этом битмапы соседних полос располагаются рядом mb use free sector bitmap mb mb mb mb mb расстояние между двумя битмапами равно mb размер полосы mb может быть изменён следующих версиях hpfs так как на него нет прямых завязок hpfs определяет размер полосы при чтении управляющих блоков диска во время выполнения операции fshelperattach размер битмапа равен mb полоса находящаяся центре диска используется для хранения каталогов эта полоса называется directory band однако если она будет полностью заполнена hpfs начнёт располагать каталоги файлов других полосах файлы каталоги hpfs базируются на фундаментальном объекте называемом fnode каждая fnode занимает один сектор hpfs всегда располагается поблизости от своего файла или каталога обычно непосредственно перед файлом или каталогом fnode содержит длину первые символов имени файла статистику по доступу файлу внутреннюю информацию расширенные атрибуты acl или только часть если они очень большие ассоциативную информацию расположении подчинении файла имена файлов каталогов при полной подстановке от корня не должны превышать символов при этом каждая компонента пути не должна быть длиннее символов именах файлов недопустимы следующие символы fh fh конечных пробелов игнорируются если на конце файла стоит точка то она тоже игнорируется для программной совместимости внутри имени файла точка такой же символ как остальные русскими буквами проблем нет при создании файла hpfs запоминает написание его имени хотя не различает регистров дальнейших операциях кроме тех что возвращают информацию файле примеры имен file asm злобный файл asm obj exe ещё более злобный файл txt точки зрения размещения файлы каталоги их расширенные атрибуты если они не помещаются fnode рассматриваются hpfs как наборы экстентов экстент это часть файла лежащая секторах каждый экстент описывается двумя числами номером первого сектора длиной секторах два экстента всегда объединяются hpfs один минимальный размер экстента один сектор так как расстояние между соседними битмапами свободных секторов равно мб то размер максимального экстента равен мб если файл состоит из восьми или менее экстентов то его описание целиком хранится fnode если файл состоит более чем из восьми экстентов то его описание может занимать несколько секторов расположенных поближе файлу при этом эти сектора содержат не список прошитое дерево экстентов дерево построено так что его разбалансировка никогда не превышает по объёму оно не отличается от оптимального более чем на один уровень корень дерева находится fnode причём может содержать до элементов каждый дополнительный сектор представляющий собой ветку дерева содержит до элементов лист элементов таким образом если файл состоит из экстентов по одному сектору этого никогда не будет имеет размер gb для его описания потребуется дерево следующей структуры mb листьев mb веток для случайного доступа любой части файла при этом потребуется худшем случае операций чтения управляющих структур реальные файлы состоят из экстентов максимальный размер файла hpfs сейчас гб однако он обусловлен только размером поля под размер файла файловым указателем байта самой os её api это не предел hpfs следует помнить что hpfs отсутствует понятие кластера файл может занимать или любое другое количество секторов при создании расширении файлов hpfs пытается минимизировать количество экстентов используя для этого статистику битовые карты свободных секторов другую информацию например hpfs старается условно резервировать хотя бы килобайта места конце файлов которые растут другой приём расположение конкурентно растущих файлов или файлов открытых разными цепочками или процессами разных полосах диска каталоги hpfs как fat образуют древовидную структуру но при этом внутри каталога hpfs строит дерево на основе имён файлов для быстрого поиска файла по имени внутри каталога например если каталог содержит файлов fat будет читать среднем сектора для поиска файла внутри каталога hpfs считает сектора найдёт файл размер блока терминах которых выделяются каталоги равен kb текущей версии hpfs размер записи описывающей файл зависит от размера имени файла если имя занимает байт то килобайтовый блок вмещает описатель файлов блоки прошиты списком как описатели экстентов для облегчения обхода hpfs не имеет fat овских проблем утекания дискового пространства при удалении большого количества файлов каталоге при переименовании файла может возникнуть дерева эта операция может потребовать выделения дополнительных блоков на заполненном диске этом случае блоки берутся из специального пула указатель на который лежит spareblock расширенные атрибуты их разновидность acl hpfs хранит fnode если они не влезают fnode hpfs хранит их почти как файл построив для этого tree имена расширенных атрибутов до hpfs не выстраивались tree hpfs hpfs драйвер для файловой системы hpfs который предназначен для серверных систем большой нагрузкой на дисковые операции драйвер hpfs поставляется lan server для os основные отличия hpfs от штатного hpfs драйвера os битный код отсутствие ограничений на размер кэша кэш ограничен лишь размером оперативной памяти поддержка списков контроля доступа acl литература горявский кое что об hpfs категория файловые системы категория os