smtp простой протокол передачи почты это широко используемый сетевой протокол предназначенный для передачи электронной почты сетях tcp ip smtp впервые был описан rfc год последнее обновление rfc включает масштабируемое расширение esmtp настоящее время под протоколом smtp как правило подразумевают его расширения протокол smtp предназначен для передачи исходящей почты использованием порта tcp то время как электронные почтовые серверы другие агенты пересылки сообщений используют smtp для отправки получения почтовых сообщений работающие на уровне клиентские почтовые приложения обычно используют smtp только для отправки сообщений на почтовый сервер для ретрансляции для получения сообщений клиентские приложения обычно используют либо pop протокол почтового отделения либо imap либо патентованные системы такие как microsoft exchange lotus notes domino для доступа учётной записи своего почтового ящика на сервере история годах использовались различные виды электронной связи люди связывались друг другом помощью систем разработанных для определённых мейнфреймов когда всё больше компьютеров становились связанными особенно сети правительства сша arpanet были разработаны стандарты для того чтобы пользователи на различных системах могли писать электронные сообщения друг другу эти стандарты разработанные годах стали основой для smtp корни smtp можно проследить двух описанных реализациях mail box protocol sndmsg который был изобретён рэем томлинсоном из bbn technologies для tops tenex компьютеров посылающих сообщения по arpanet то время ней были подсоединены менее хостов дальнейшие реализации включают себя ftp mail mail protocol разработанные разработка продолжалась на протяжении пока arpanet не преобразовалась современный интернет около том же году джон постел предложил mail transport protocol протокол передачи почты благодаря которому ftp перестал быть основой для передачи почты smtp опубликован rfc также написанном постелом августе стандарт smtp был разработан примерно то же время что usenet сеть передачи данных имеющая некоторые сходства smtp smtp стал широко использоваться ранние то время он был дополнением для работающей под unix почтовой программы unix to unix copy uucp которая больше подходила для обработки передачи электронных сообщений между периодически связанными устройствами другой стороны smtp прекрасно работает когда как отправляющее так принимающее устройства связаны сети постоянно оба устройства используют механизм хранения пересылки являются примером push технологии технологии проталкивания хотя новостные группы usenet все ещё между серверами помощью uucp почта uucp фактически исчезла вместе маршрутом bang path хост машин сети по которой сообщение должно дойти до адресата которые использовались как заголовки маршрутизации статье перезаписи отправителя содержится техническая справочная информация об истории раннего smtp маршрутизации от источника до rfc sendmail был одним из первых если не первым агентом пересылки сообщений котором был реализован smtp число других популярных серверных программ поддерживающих smtp входят postfix qmail novell groupwise exim novell netmail microsoft exchange server sun java system messaging server предоставление сообщений rfc smtp auth rfc были введены гг описывали новые тенденции передаче электронных сообщений изначально smtp сервера были обычно внутренними для организации получая сообщения от организаций извне ретранслируя сообщения организации во внешнюю среду но течением времени smtp сервера агенты пересылки сообщений на деле расширяли свои функции конце концов стали агентами предоставления сообщений для почтовых приложений некоторые из которых теперь ретранслировали почту извне организации например руководитель компании будучи поездке хочет отправить электронное сообщение помощью корпоративного smtp сервера данный вопрос являясь следствием быстрого развития популярности всемирной паутины означает что smtp должен был включать себя особые правила методы для ретрансляции сообщений авторизации пользователей для предотвращения таких злоупотреблений как ретрансляция нежелательной почты спам поскольку этот протокол сначала был текстовым ascii интерфейсом то он плохо работал бинарными файлами символами многих не английских языков такие стандарты как multipurpose internet mail extensions mime были разработаны для кодирования двоичных файлов для передачи через smtp разработанные после sendmail агенты пересылки как правило также осуществляли опцию чистых бит так что альтернативная стратегия просто посылай восемь может быть использована для передачи произвольных текстовых данных любой восьми битной ascii подобной кодировке символов через smtp однако все ещё оставалась проблема вызванная разным отображением наборов символов производителей хотя сами почтовые адреса все ещё позволяли использовать исключительно ascii сегодня агенты пересылки работающие чистыми битами как правило поддерживают расширение bitmime позволяющее передавать бинарные файлы почти так же легко как обычный текст недавно было создано расширение smtputf для поддержки текста кодировке utf благодаря чему стало возможным включать международное содержимое адреса использованием таких алфавитов как кириллица или китайский многие выдающиеся люди внесли свой вклад спецификацию основного smtp среди них джон постел эрик оллман дэйв крокер нед фрид рэндалл джелленс джон кленсин кейт мур модель обработки почты синие стрелки могут быть реализованы использованием различных версий smtp электронная почта представлена почтовым клиентом mua mail user agent почтовый агент для почтового сервера msa mail submission agent агент отправки электронной почты помощью smtp по tcp порту оттуда msa доставляет почту своим агентам передачи сообщений mta mail transfer agent часто эти два агента являются просто различными образцами одного того же программного обеспечения запущенного разными параметрами на одном устройстве локальная обработка может быть проведена как на отдельной машине так разделена между различными устройствами первом случае вовлеченные процессы имеют общий доступ файлам во втором случае smtp используется для пересылки сообщения внутренне причём каждый хост настроен на использование следующего устройства качестве промежуточного хоста каждый процесс сам по себе mta то есть smtp сервер граничный mta должен найти целевой хост он использует систему доменных имен dns для поиска записей почтового обменника mail exchanger mx домена получателя часть адреса находящаяся справа от символа возвращаемая запись почтового mx содержит имя целевого хоста затем mta подключается серверу обмена качестве smtp клиента как только цель mx принимает входящее сообщение она передаёт его агенту доставки почты mail delivery agent mda для локальной доставки сообщения mda предусматривает возможность сохранять сообщения соответствующем формате почтового ящика приём почты опять же может быть проведен как несколькими так одним компьютером изображение показывает два ближайших ящика для каждого случая mda может доставлять сообщения прямо на хранение или передавать их по сети помощью smtp или любых других средств том числе протокола локальной пересылки почты local mail transfer protocol lmtp производного от smtp для этой цели после доставки на локальный почтовый сервер сообщение хранится для пакетного поиска по почтовым клиентам mua сообщение извлекается приложениями конечного пользователя почтовыми клиентами использованием протокола imap internet message access protocol который облегчает доступ сообщениям управляет хранящейся почтой или помощью протокола pop post office protocol который обычно использует традиционный mbox формат файлов или фирменными системами вроде microsoft exchange outlook или lotus notes domino клиенты сетевой почты могут использовать любой метод но протокол поиска часто не соответствует официальным стандартам smtp определяет передачу сообщения не его содержание таким образом он задаёт оболочку сообщения её параметры такие как отправитель оболочки но не заголовок либо тело самого сообщения std rfc определяют smtp оболочку то время как std rfc сообщение заголовок тело официально называемый форматом почтового сообщения internet message format обзор протокола smtp требующий соединения текстовый протокол по которому отправитель сообщения связывается получателем посредством выдачи командных строк получения необходимых данных через надёжный канал роли которого обычно выступает tcp соединение transmission control protocol протокол управления передачей smtp сессия состоит из команд посылаемых smtp клиентом соответствующих ответов smtp сервера когда сессия открыта сервер клиент обмениваются её параметрами сессия может включать ноль более smtp операций транзакций smtp операция состоит из трёх команда ответ см пример ниже описание mail from устанавливает обратный адрес то есть return path from mfrom это адрес для возвращённых писем rcpt to устанавливает получателя данного сообщения эта команда может быть дана несколько раз по одному на каждого получателя эти адреса также являются частью оболочки data для отправки текста сообщения это само содержимое письма его оболочке он состоит из заголовка сообщения тела сообщения разделённых пустой строкой data по сути является группой команд сервер отвечает дважды первый раз на саму команду data для уведомления готовности принять текст второй раз после конца данных чтобы принять или отклонить всё письмо помимо промежуточных ответов для data команды каждый ответ сервера может быть положительным код ответа хх или отрицательным последний свою очередь может быть постоянным код хх либо временным код хх отказ smtp сервера передаче сообщения постоянная ошибка этом случае клиент должен отправить возвращённое письмо после сброса положительного ответа сообщение скорее всего будет отвержено также сервер может сообщить том что ожидаются дополнительные данные от клиента код xx изначальным хостом smtp клиентом может быть как почтовый клиент конечного пользователя функционально определяемый как почтовый агент mua так агент пересылки сообщений mta на сервере то есть сервер действует как клиент соответствующей сессии для ретрансляции сообщения полностью функциональные сервера поддерживают очереди сообщений для повторной передачи сообщения случае ошибок mua знает smtp сервер для исходящей почты из своих настроек smtp сервер действующий как клиент то есть пересылающий сообщения определяет какому серверу подключиться просмотром ресурса записей mx mail exchange dns для домена каждого получателя случае если запись mx не найдена совместимые mta не все возвращаются простой записи пересылающие сервера также могут быть настроены на использование smart host smtp сервер действующий как клиент устанавливает tcp соединение сервером по разработанному для smtp порту mua должен использовать порт для подключения агенту предоставления сообщений msa основное различие между mta msa заключается том что smtp аутентификация обязательна только для последнего smtp извлечение сообщений smtp всего лишь протокол доставки он не может по требованию взять сообщения удалённого сервера для извлечения почты управления почтовым ящиком разработаны другие протоколы такие как pop imap тем не менее smtp предоставляет возможность начать на удалённом сервере обработку очереди сообщений при которой запрашивающая система может получать все направленные ей сообщения см remote message queue starting ниже pop imap предпочтительны когда компьютер пользователя включён не постоянно или же временно подключен интернету remote message queue starting remote message queue starting запуск удалённой очереди сообщений особенность smtp позволяющая удаленному хосту начать обработку очереди сообщений на сервере так что он может получать предназначенные ему сообщения помощью команды turn однако эта особенность считалась небезопасной была расширена rfc командой etrn которая работает надёжнее благодаря основанному на информации dns методу аутентификации on demand mail relay odmr on demand mail relay ретрансляция почты по требованию rfc smtp расширение позволяющее проводить ретрансляцию сообщения пользователю многие пользователи чей набор символов отличается от латиницы сталкиваются требованием адреса электронной почты на латинице для решения этой проблемы был создан rfc предоставляющий возможности для для smtp расширение smtputf rfc предоставляет поддержку многобайтных не ascii символов почтовом адресе например δοκιμή παράδειγμα δοκιμή или 测试 测试 测试 текущая поддержка ограничена но есть большой интерес широком распространении rfc связанных ним rfc странах обширной базой пользователей для которых латиница не является родным алфавитом smtp сервер исходящей почты почтовый клиент должен знать ip адрес smtp сервера который задаётся как часть конфигурации обыкновенно виде dns имени сервер будет доставлять исходящие сообщения от лица пользователя ограничения доступа серверу исходящей почты администраторам сервера необходимо контролировать то какие клиенты могут использовать сервер это позволяет им бороться такими как спам обычно используются два решения прошлом многие системы вводили ограничения по местоположению клиента допуская использованию лишь тех чей ip адрес был среди подконтрольных администраторам современные сервера обычно предлагают альтернативную систему требующую аутентификацию клиентов для получения доступа ограничение доступа по местоположению этом случае smtp сервер интернет провайдера не разрешит допуск пользователям за пределами сети провайдера точнее сервер может допустить лишь тех пользователей чей ip адрес предоставлен данным провайдером что эквивалентно требованию соединения интернетом помощью этого провайдера мобильный пользователь часто может оказаться сети отличной от сети своего провайдера потому сообщения не будут отправляться данной системы есть несколько разновидностей например smtp сервер организации может предоставлять доступ только пользователям той же сети блокируя остальных пользователей также сервер может проводить ряд проверок клиентского ip адреса эти методы обычно использовались организациями учреждениями например университетами для внутреннего пользования сервером однако большая их часть теперь использует описанные ниже методы аутентификации благодаря ограничению доступа определённым адресам администраторы сервера могут легко определить адрес любого злоумышленника если пользователь может использовать различные провайдеры для соединения интернетом этот вид ограничения становится изменение настроенного адреса smtp сервера исходящей почты непрактично крайне желательно иметь возможность использовать такую информацию настройках клиента которая не нуждается изменении аутентификация клиента вместо описанного ранее ограничения по местоположению современные smtp сервера обычно требуют аутентификацию пользователей перед получением доступа эта система будучи более гибкой поддерживает мобильных пользователей предоставляет им фиксированный выбор настроенного сервера исходящей почты открытый релей сервер доступный для широкой сети не предоставляющий эти виды ограничения доступа называют открытым релеем сейчас такие серверы считаются дурным тоном порты администраторы сервера выбирают какой порт будут использовать клиенты для ретрансляции исходящей почты или спецификации многие серверы поддерживают тот другой порты хотя некоторые серверы поддерживают порт для безопасного smtp но использовать стандартные порты esmtp команды если необходима защищённая сессия между клиентом сервером некоторые серверы настроены на отклонение всех ретрансляций по порту но пользователям прошедшим аутентификацию по порту позволено перенаправлять сообщения на любой действительный адрес некоторые провайдеры перехватывают порт перенаправляя трафик на свой собственный smtp сервер вне зависимости от адреса назначения таким образом их пользователи не могут получить доступ серверу за пределами провайдерской сети по порту некоторые серверы поддерживают доступ по дополнительному отличному от порту позволяя пользователям соединяться ними даже если порт заблокирован пример простейшей smtp сессии клиент сервер ожидает соединения подключается порту сервера mail company tld esmtp is glad to see you helo domain name should be qualified mail from someusername somecompany ru sender accepted rcpt to user company tld ok rcpt to user company tld unknown user account data enter mail end with on line by itself from some user to user subject tema content type text plain hi message accepted for delivery quit mail company tld communigate pro smtp closing connection закрывает соединение результате такой сессии письмо будет доставлено адресату user company tld но не будет доставлено адресату user company tld потому что такого адреса не существует дополнительные расширения многие клиенты запрашивают расширения smtp поддерживаемые сервером помощью команды ehlo из спецификации расширенного smtp rfc helo используется только том случае если сервер не ответил на ehlo современные клиенты могут использовать ключ size расширения esmtp для запроса максимального размера сообщения которое будет принято более старые клиенты сервера могут попытаться передать чрезмерно большие сообщения которые будут отклонены после потребления сетевых ресурсов включая время соединения пользователи могут вручную заранее определить максимальный размер принимаемый esmtp серверами клиент заменяет команду helo на ehlo smtp example com esmtp postfix helo bob example org smtp example com hello bob example org size pipelining help smtp example com объявляет что он примет сообщение размером не больше чем октетов битных байтов зависимости от фактического использования сервера он может на данный момент не принять сообщение такой величины простейшем случае esmtp сервер объявит максимальный size только при взаимодействии пользователем через ehlo безопасность smtp спам изначальная спецификация smtp не включала средств для аутентификации отправителей впоследствии rfc было введено расширение расширение smtp esmtp предоставляет почтовым клиентам возможности задания механизма обеспечения безопасности для сервера аутентификации профиля безопасности sasl simple authentication and security layer для последующих передач сообщений продукты microsoft реализуют собственный протокол spa secure password authentication помощью расширения smtp auth однако непрактичность широкого распространения реализации управления smtp auth означает что проблема спама не может быть решена его помощью обширное изменение smtp так же как полная его замена считаются непрактичными из за огромной базы smtp internet mail был одним из претендентов для такой замены спам функционирует благодаря различным факторам том числе не соответствующие стандартам реализации mta уязвимости защите операционных систем усугубляемые постоянным широкополосным подключением что позволяет спамерам удаленно контролировать компьютер конечного пользователя посылать него спам существует несколько предложений для побочных протоколов помогающих работе smtp группа anti spam the anti spam research group asrg подразделение группы интернет технологий работает над почтовой аутентификацией другими предложениями для предоставления простой аутентификации которая будет гибкой легковесной масштабируемой недавняя деятельность инженерного совета интернета ietf включает себя marid приведший двум утверждённым ietf экспериментам domainkeys identified mail расширения esmtp starttls rfc предписывает начинать сессию не командой helo командой ehlo случае если сервер не поддерживает расширений то он ответит на ehlo ошибкой этом случае клиент должен послать команду helo не использовать расширения протокола если же сервер поддерживает esmtp то кроме приветствия он сообщит список поддерживаемых расширений протокола smtp например ehlo office company tld mail company tld is pleased to meet you dsn size starttls auth login plain cram md digest md gssapi msn ntlm etrn turn atrn no soliciting help pipelining helo стандарты rfc rfc smtp service extension for message size declaration заменяет rfc rfc smtp service extension for returning enhanced error codes rfc anti spam recommendations for smtp mtas bcp rfc smtp service extension for authentication заменяет rfc rfc internet message format заменяет rfc aka std rfc smtp service extension for command pipelining std rfc smtp service extensions for transmission of large and binary mime messages rfc smtp service extension for secure smtp over transport layer security заменяет rfc rfc smtp service extension for delivery status notifications заменяет rfc rfc the multipart report content type for the reporting of mail system administrative messages заменяет rfc rfc enhanced status codes for smtp заменяет rfc rfc an extensible message format for delivery status notifications заменяет rfc rfc guidelines for writing rfc text on security considerations rfc recommendations for automatic responses to electronic mail rfc message submission for mail заменяет rfc rfc simple mail transfer protocol заменяет rfc aka std rfc rfc rfc rfc smtp extension for email addresses перевод rfc рекомендации по предотвращению спама для smtp mta перевод rfc расширение сервиса smtp для аутентификации перевод rfc простой протокол передачи электронной почты smtp см также lmtp производный от smtp протокол ориентированный на работу без очереди сообщений pop imap tcp sender policy framework sender id предотвращение утечек информации через smtp литература категория электронная почта категория протоколы прикладного уровня