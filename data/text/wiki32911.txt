ospf протокол динамической маршрутизации основанный на технологии отслеживания состояния канала link state technology использующий для нахождения кратчайшего пути алгоритм дейкстры протокол ospf был разработан ietf году последняя версия протокола представлена rfc год протокол ospf представляет собой протокол внутреннего шлюза interior gateway protocol igp протокол ospf распространяет информацию доступных маршрутах между одной автономной системы ospf имеет следующие преимущества высокая скорость сходимости по сравнению дистанционно векторными протоколами маршрутизации поддержка сетевых масок переменной длины vlsm оптимальное использование пропускной способности построением дерева кратчайших путей терминология протокола ospf интерфейс interface соединение маршрутизатора одной из подключенных нему сетей при обсуждении ospf термины интерфейс канал link часто употребляются как синонимы объявление состоянии канала link state advertisement lsa объявление описывает все каналы маршрутизатора все интерфейсы состояние каналов состояние канала link state состояние канала между двумя обновления происходят при помощи пакетов lsa метрика metric условный показатель стоимости пересылки данных по каналу автономная система autonomous system это совокупность сетей под единым управлением обеспечивающим общую для всех входящих автономную систему маршрутизаторов политику маршрутизации обычно автономной системой управляет один поставщик услуг интернет автономная система использует внутренние шлюзовые протоколы igp rip ospf is is зона area совокупность сетей маршрутизаторов имеющих один тот же идентификатор зоны соседи neighbours два маршрутизатора имеющие интерфейсы общей сети состояние смежности adjacency взаимосвязь между определёнными соседними установленная целью обмена информацией маршрутизации hello протокол hello protocol используется для поддержания соседских отношений база данных соседей neighbours database список всех соседей база данных состояния каналов link state database lsdb список всех записей состоянии каналов встречается также термин топологическая база данных topological database употребляется как синоним базы данных состояния каналов идентификатор маршрутизатора router id rid уникальное битовое число которое уникально идентифицирует маршрутизатор пределах одной автономной системы описание работы протокола маршрутизаторы обмениваются hello пакетами через все интерфейсы на которых активирован ospf маршрутизаторы разделяющие общий канал передачи данных становятся соседями когда они приходят договоренности об определённых параметрах указанных их hello пакетах на следующем этапе работы протокола маршрутизаторы будут пытаться перейти состояние смежности со своими соседями переход состояние смежности определяется типом маршрутизаторов обменивающихся hello пакетами типом сети по которой передаются hello пакеты ospf определяет несколько типов сетей несколько типов маршрутизаторов пара маршрутизаторов находящихся состоянии смежности синхронизирует между собой базу данных состояния каналов каждый маршрутизатор посылает объявления состоянии канала маршрутизаторам которыми он находится состоянии смежности каждый маршрутизатор получивший объявление от смежного маршрутизатора записывает передаваемую нём информацию базу данных состояния каналов маршрутизатора рассылает копию объявления всем другим смежным ним маршрутизаторам рассылая объявления внутри одной ospf зоны все маршрутизаторы строят идентичную базу данных состояния каналов маршрутизатора когда база данных построена каждый маршрутизатор использует алгоритм кратчайший путь первым для вычисления графа без петель который будет описывать кратчайший путь каждому известному пункту назначения собой качестве корня этот граф дерево кратчайших путей каждый маршрутизатор строит таблицу маршрутизации из своего дерева кратчайших путей типы сетей поддерживаемые протоколом ospf сети со множественным доступом ethernet token ring точка точка коммутируемый доступ сети со множественным доступом nbma frame relay выделенный маршрутизатор dr резервный выделенный маршрутизатор bdr сетях со множественным доступом отношения соседства устанавливаются между всеми если бы все маршрутизаторы состоянии соседства обменивались топологической информацией это привело бы рассылке большого количество копий lsa если примеру количество маршрутизаторов сети со множественным доступом равно то будет установлено отношений соседства каждый маршрутизатор будет рассылать lsa своим соседям плюс одно lsa для сети результате сеть сгенерирует n² lsa для предотвращения проблемы рассылки копий lsa сетях со множественным доступом выбираются выделенный маршрутизатор dr запасной выделенный маршрутизатор bdr выделенный маршрутизатор designated router dr управляет процессом рассылки lsa сети каждый маршрутизатор сети устанавливает отношения смежности dr информация об изменениях сети отправляется маршрутизатором обнаружившим это изменение на выделенный маршрутизатор тот свою очередь отвечает за то чтобы эта информация была отправлена остальным маршрутизаторам сегмента множественного доступа недостатком схеме работы dr маршрутизатором является то что при выходе его из строя должен быть выбран новый dr новые отношения соседства должны быть сформированы пока базы данных маршрутизаторов не базой данных нового dr сеть будет недоступна для пересылки пакетов для устранения этого недостатка выбирается bdr резервный выделенный маршрутизатор backup designated router bdr каждый маршрутизатор сети устанавливает отношения соседства не только dr но bdr dr bdr также устанавливают отношения соседства между собой при выходе из строя dr bdr становится dr выполняет все его функции так как маршрутизаторы сети установили отношения соседства bdr время недоступности сети минимизируется маршрутизатор выбранный dr или bdr одной присоединённой нему сети множественного доступа может не быть dr bdr другой присоединённой сети множественного доступа роль dr bdr является свойством интерфейса не свойством всего маршрутизатора иными словами каждом сегменте множественного доступа например коммутационном сегменте ethernet котором общаются два или более ospf маршрутизатора процесс выбора распределение ролей dr bdr происходит независимо от других сегментов множественного доступа таймеры протокола hellointerval интервал времени секундах по истечении которого маршрутизатор отправляет следующий hello пакет интерфейса для сетей сетей точка точка значение по умолчанию как правило секунд для сетей со множественным доступом значение по умолчанию секунд интервал времени секундах по истечении которого сосед будет считаться мертвым этот интервал должен быть кратным значению hellointerval как правило равен интервалам отправки hello пакетов то есть секунд wait timer интервал времени секундах по истечении которого маршрутизатор выберет dr сети его значение равно значению интервала rxmtinterval интервал времени секундах по истечении которого маршрутизатор повторно отправит пакет на который не получил подтверждения получении например database description пакет или link state request пакеты этот интервал называется также retransmit interval значение интервала секунд типы маршрутизаторов внутренний маршрутизатор internal router маршрутизатор все интерфейсы которого принадлежат одной зоне таких маршрутизаторов только одна база данных состояния каналов пограничный маршрутизатор area border router abr соединяет одну или больше зон магистральной зоной выполняет функции шлюза для межзонального трафика пограничного маршрутизатора всегда хотя бы один интерфейс принадлежит магистральной зоне для каждой присоединенной зоны маршрутизатор поддерживает отдельную базу данных состояния каналов магистральный маршрутизатор backbone router маршрутизатор которого всегда хотя бы один интерфейс принадлежит магистральной зоне определение похоже на пограничный маршрутизатор однако магистральный маршрутизатор не всегда является пограничным внутренний маршрутизатор интерфейсы которого принадлежат нулевой зоне также является магистральным пограничный маршрутизатор автономной системы as boundary router asbr это маршрутизатор один из портов которого находится домене ospf протокола другой домене любого из внутренних шлюзовых протоколов например rip или eigrp пограничный маршрутизатор автономной системы может находиться любом месте автономной системы быть пограничным или магистральным маршрутизатором типы объявлений состоянии канала lsa type lsa router lsa объявление состоянии каналов маршрутизатора эти lsa всеми lsa содержится описание всех каналов маршрутизатора стоимость cost каждого канала только пределах одной зоны type lsa network lsa объявление состоянии каналов сети dr сетях со множественным доступом lsa содержится описание всех маршрутизаторов присоединенных сети включая dr только пределах одной зоны type lsa network summary lsa суммарное объявление состоянии каналов сети объявление пограничными объявление описывает только маршруты сетям вне зоны не описывает маршруты внутри автономной системы пограничный маршрутизатор отправляет отдельное объявление для каждой известной ему сети когда маршрутизатор получает network summary lsa от пограничного маршрутизатора он не запускает алгоритм вычисления кратчайшего пути маршрутизатор просто добавляет стоимости маршрута указанного lsa стоимость маршрута пограничному маршрутизатору затем маршрут сети через пограничный маршрутизатор помещается таблицу маршрутизации type lsa asbr summary lsa суммарное объявление состоянии каналов пограничного маршрутизатора автономной системы объявление пограничными asbr summary lsa отличается от network summary lsa тем что информация не сети пограничном маршрутизаторе автономной системы type lsa as external lsa объявление состоянии внешних каналов автономной системы объявление пограничным маршрутизатором автономной системы пределах всей автономной системы объявление описывает маршруты внешние для автономной системы ospf или маршруты по умолчанию default route внешние для автономной системы ospf type lsa multicast ospf lsa lsa который используют мультикаст ospf приложения not implemented by cisco type lsa as external lsa for nssa объявления состоянии внешних каналов автономной системы nssa зоне это объявление может передаваться только nssa зоне на границе зоны пограничный маршрутизатор преобразует type lsa type lsa type lsa link lsa анонсирует link local адрес префикс маршрутизатора всем маршрутизаторам разделяющим канал link отправляется только если на канале присутствует более чем один маршрутизатор только пределах канала link type lsa intra area prefix lsa ставит соответствие список префиксов ipv маршрутизатор указывая на router lsa список префиксов ipv транзитную сеть указывая на network lsa только пределах одной зоны типы зон при разделении автономной системы на зоны маршрутизаторам принадлежащим одной зоне не известна информация детальной топологии других зон разделение на зоны позволяет снизить нагрузку на цп маршрутизаторов за счёт уменьшения количества перерасчётов по алгоритму ospf уменьшить размер таблиц маршрутизации уменьшить количество пакетов обновлений состояния канала каждой зоне присваивается идентификатор зоны area id идентификатор может быть указан десятичном формате или формате записи ip адреса однако идентификаторы зон не являются ip адресами могут совпадать любым назначенным ip адресом существует несколько типов зон магистральная зона backbone area магистральная зона известная также как нулевая зона или зона формирует ядро сети ospf все остальные зоны соединены ней межзональная маршрутизация происходит через маршрутизатор соединенный магистральной зоной магистральная зона ответственна за распространение информации между зонами магистральная зона должна быть смежной другими зонами но она не обязательно должна быть физически смежной соединение магистральной зоной может быть установлено помощью виртуальных каналов стандартная зона standard area обычная зона которая создается по умолчанию эта зона принимает обновления каналов суммарные маршруты внешние маршруты тупиковая зона stub area тупиковая зона не принимает информацию внешних маршрутах для автономной системы но принимает маршруты из других зон если маршрутизаторам из тупиковой зоны необходимо передавать информацию за границу автономной системы то они используют маршрут по умолчанию тупиковой зоне не может находиться asbr totally stubby area totally stubby area не принимает информацию внешних маршрутах для автономной системы маршруты из других зон если маршрутизаторам необходимо передавать информацию за пределы зоны то они используют маршрут по умолчанию cisco proprietary тип зоны not so stubby area nssa зона nssa определяет дополнительный тип lsa lsa type nssa зоне может находиться asbr формат ospf пакетов ospf пакет инкапсулируется непосредственно поле данных ip пакета значение поля протокол верхнего уровня заголовке ip дейтаграммы для ospf равно заголовок пакета октет version type packet length router id area id checksum authentication type authentication version номер версии протокола ospf текущая версия ospf для сетей ipv type тип ospf пакета packet length длина пакета включая заголовок router id идентификатор маршрутизатора уникальное битное число маршрутизатор пределах автономной системы area id битный идентификатор зоны checksum поле контрольной суммы подсчитывается для всего пакета включая заголовок authentication type тип используемой схемы аутентификации возможные значения аутентификация не используется аутентификация открытым текстом md аутентификация authentication поле данных аутентификации hello пакет hello пакет предназначен для установления поддержания отношений соседями пакет периодически посылается на все интерфейсы маршрутизатора октет version type packet length router id area id checksum authentication type authentication network mask hello interval options router priority router dead interval designated router backup designated router neighbor id network mask сетевая маска интерфейса через который отправляется hello пакет hello interval интервал задающий частоту рассылки приветственных сообщений для обнаружения соседей автономной системе для lan значение по умолчанию равно секундам options битное поле опций описывает возможности маршрутизатора router priority приоритет маршрутизатора битное число символизирующее приоритет маршрутизатора при выборе dr bdr router dead interval период времени течение которого маршрутизатор ожидает ответа соседей designated router dr ip адрес dr backup designated router bdr ip адрес bdr neighbor id идентификатор соседа список составляется из идентификаторов соседей от которых маршрутизатор получил hello пакеты течение времени заданного поле router dead interval database description пакет database description описывает содержание базы данных состояния канала обмен пакетами производится при установлении состояния смежности октет version type packet length router id area id checksum authentication type authentication interface mtu options ms dd sequence number lsa headers interface mtu размер байтах наибольшей ip дейтаграммы которая может быть послана через данный интерфейс без фрагментации бит устанавливается для первого пакета бит указывает наличие последующих дополнительных пакетов ms бит устанавливается для ведущего сбрасывается для ведомого dd sequence number начальном пакете устанавливается на уникальное значение при передаче каждого последующего пакета увеличивается на единицу пока не будет передана вся база данных lsa headers массив заголовков базы данных состояния каналов link state request пакет link state request предназначен для запроса части базы данных соседнего маршрутизатора октет version type packet length router id area id checksum authentication type authentication ls type link state id advertising router ls type тип объявления состоянии канала link state id идентификатор домена маршрутизации advertising router идентификатор маршрутизатора создавшего объявление состоянии канала link state update пакет link state update предназначен для рассылки объявлений состоянии канала пакет посылается по групповому адресу на один транзитный участок октет version type packet length router id area id checksum authentication type authentication number of lsa lsa number of lsa количество объявлений пакете link state acknowledgment подтверждает получение пакета link state update октет version type packet length router id area id checksum authentication type authentication lsa headers версии протокола ospf ospf версия ospf версия поддерживает версию протокола ipv ospf версия поддерживает версию протокола ipv критика считается что благодаря использованию алгоритма дейкстры специфического критерия качества распределения входного потока информации он абсолютно не защищает ip сеть от перегрузок что требует реализации дополнительных методов по снижению вероятности перегрузки например предлагается использовать критерии распределения остаточную пропускную способность канала то же время положительным качествам протокола можно отнести относительную простоту практической реализации алгоритма см также протокол маршрутизации промежуточных систем is is shortest path bridging spb примечания литература категория протоколы маршрутизации категория интернет протоколы