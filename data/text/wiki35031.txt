семафо объект ограничивающий количество потоков которые могут войти заданный участок кода определение введено эдсгером дейкстрой или году семафоры используются для синхронизации защиты передачи данных через разделяемую память также для синхронизации работы процессов потоков определение семафора семафор это объект над которым можно выполнить три операции инициализация семафора задать начальное значение счётчика init счётчик захват семафора ждать пока счётчик станет больше после этого уменьшить счётчик на единицу enter счётчик счётчик освобождение семафора увеличить счётчик на единицу leave счётчик счётчик предположим что есть такой участок кода semaphore init void dosomething semaphore enter semaphore leave тогда не более пяти потоков могут одновременно выполнять функцию dosomething более сложных семафорах может использоваться очередь при этом потоки ожидающие освобождения семафора будут проходить через семафор именно том порядке котором они вызывали enter применение семафоров некоторые из проблем которые могут решать семафоры запрет одновременного выполнения заданных участков кода критические секции поочерёдный доступ критическому ресурсу важному ресурсу для которого невозможен или нежелателен одновременный доступ синхронизация процессов потоков например можно инициировать обработку события отпусканием семафора следующий пример показывает как наладить поочерёдный доступ консоли semaphore init поток semaphore enter cout этот код поможет предотвратить появление вывода наподобие состояние массива нажато esc проблемы семафоров во первых можно написать программу утечкой семафора вызвав enter забыв вызвать leave реже встречаются ошибки когда дважды вызывается leave во вторых семафоры чреваты взаимной блокировкой потоков частности опасен такой код поток semaphore enter semaphore enter semaphore leave semaphore leave поток semaphore enter semaphore enter semaphore leave semaphore leave см также асинхронный семафор критическая секция мьютекс фьютекс состояние гонки разделяемая память условная переменная литература примечания ссылки пример реализации семафора политикой fifo microsoft net категория управление конкурентными потоками категория статьи примерами кода