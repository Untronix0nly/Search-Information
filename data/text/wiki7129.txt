xpath xml path language язык запросов элементам xml документа разработан для организации доступа частям документа xml файлах трансформации xslt является стандартом консорциума xpath призван реализовать навигацию по dom xml xpath используется компактный синтаксис отличный от принятого xml году завершилась разработка версии которая теперь является составной частью языка xquery декабре года началась разработка версии которая использует xquery на данный момент самой популярной версией является xpath это связано отсутствием поддержки xpath со стороны открытых библиотек частности речь идёт libxml от которой зависит поддержка языка браузерах одной стороны поддержка со стороны серверного интерпретатора другой основы xml имеет древовидную структуру самостоятельном xml документе всегда имеется один корневой элемент инструкция дереву элементов отношения не имеет котором допустим ряд вложенных элементов некоторые из которых тоже могут содержать вложенные элементы так же могут встречаться текстовые узлы комментарии инструкции можно считать что xml элемент содержит массив вложенных него элементов массив атрибутов элементов дерева бывают элементы предки элементы потомки корневого элемента предков нет тупиковых элементов листьев дерева нет потомков каждый элемент дерева находится на определённом уровне вложенности далее уровень элементы упорядочены порядке расположения тексте xml поэтому можно говорить об их предыдущих следующих элементах это очень похоже на организацию каталогов файловой системе строка xpath описывает способ выбора нужных элементов из массива элементов которые могут содержать вложенные элементы начинается отбор переданного множества элементов на каждом шаге пути отбираются элементы соответствующие выражению шага результате оказывается отобрано подмножество элементов соответствующих данному пути для примера возьмём следующий xhtml документ первый слой блок текста первом слое второй слой третий слой первый блок третьем слое второй блок третьем слое третий блок третьем слое четвёртый слой xpath путь html body span class будет соответствовать нём двум элементам исходного документа первый блок третьем слое второй блок третьем слое элементы пути преимущественно пишутся xpath краткой форме полная форма приведённого выше пути имеет вид child html child body child child spanattribute class путь состоит из шагов адресации которые разделяются символом косая черта каждый шаг адресации состоит из трёх частей ось по умолчанию child ось элементов кроме отбора по оси вложенных элементов можно отбирать разным другим осям элементов по оси атрибутов attribute она же обозначается символом см ниже выражение определяющее отбираемые элементы примере отбор делается по соответствию элементов документа именам html body span используется символ который отберёт все элементы оси предикаты данном примере это attribute class дополнительные условия отбора их может быть несколько каждый предикат заключается квадратные скобки подразумевает логическое выражение для проверки отбираемых элементов если предиката нет то отбираются все подходящие элементы анализ пути ведётся слева направо начинается либо контексте корневыми элементами переданого xml по оси child если начале xpath указан символ либо контексте самого корневого узла по оси child будут его вложенные элементы что удобно случае обработки полноценного xml документа на каждом шаге адресации текущем контексте отбираются элементы подходящие под указанные шаге условия берутся как контекст для следующего шага или возвращаемый результат данном примере если начать xpath символа ось child содержала бы один элемент body иначе на первом шаге ось child содержит элементы корневого элемента то есть данном примере ось child содержала бы один элемент html таким образом первый шаг child html явным образом делает текущим контекстом для следующего шага элемент html что было бы так сделано неявно если этот шаг не был обозначен на втором шаге адресации child body контекстом является элемент html ось child говорит том что необходимо смотреть на имена вложенных элементов текущем контексте условие проверки body говорит том что формируемый набор элементов нужно включить те узлы которых имя body таким образом ходе второго шага адресации получаем набор узлов состоящий всего из одного элемента body который становится контекстом для третьего шага третий шаг адресации child ось child содержит всех потомков элемента body условие проверки говорит том что формируемый набор нужно включить элементы основного типа любым именем ходе этого шага получаем набор узлов состоящий из трёх элементов div одного span одного элемента img итого пять элементов четвёртый шаг адресации child span class его контекстом является набор из пяти элементов поэтому следующий набор узлов создаётся пять проходов за пять итераций при первой итерации узлом контекста становится первый div согласно заданной оси child правилу проверки span набор должны включаться потомки этого div имя которых равно span там такой один при второй итерации набор ничего добавляться не будет так как второго div нет потомков третья итерация увидит сразу три элемента span четвёртая ничего не увидит так как элемента span нет потомков span то что он сам span не важно ведь просматриваются именно потомки пятая тоже ничего не увидит элемента img тоже нет потомков span итак ходе проверки мог бы быть получен набор узлов состоящий из четырёх элементов span это было бы контекстом для последующей обработки не будь на этом шаге указано предиката но так как предикат на четвёртом шаге есть по мере выполнения каждого из пяти проходов будет производиться дополнительная фильтрация отбираемых элементов данном случае предиката ось attribute говорит необходимости проверить есть ли отбираемого узла атрибуты условие class требует оставить лишь те узлы которых задан атрибут именем class поэтому на первой итерации единственный найденный span фильтрацию предикатом не пройдёт на третьей итерации фильтрацию пройдут два элемента из трёх итоге несмотря на то что фильтрация происходит за пять итераций окончательный набор попадают только два элемента span оси оси это база языка xpath для некоторых осей существуют сокращённые обозначения child содержит множество элементов потомков элементов расположенных на один уровень ниже это название сокращается полностью то есть его можно вовсе опускать descendant содержит полное множество элементов потомков то есть как ближайших элементов потомков так всех их элементов потомков descendant or self содержит полное множество элементов потомков текущий элемент выражение descendant or self node можно сокращать до помощью этой оси например можно вторым шагом организовать отбор элементов любого узла не только корневого достаточно первым шагом взять всех потомков корневого например путь span отберёт все узлы span документа независимо от их положения иерархии взглянув как на имя корневого так на имена всех его дочерних элементов на всю глубину их вложенности ancestor содержит множество элементов предков ancestor or self содержит множество элементов предков текущий элемент parent содержит элемент предок на один уровень назад это обращение можно заменить на self содержит текущий элемент это обращение можно заменить на following содержит множество элементов расположенных ниже текущего элемента по дереву на всех уровнях слоях исключая собственных потомков following sibling содержит множество братских элементов того же уровня следующих за текущим слоем preceding содержит множество элементов расположенных выше текущего элемента по дереву на всех уровнях слоях исключая множество собственных предков preceding sibling содержит множество братских элементов того же уровня предшествующих текущему слою attribute содержит множество атрибутов текущего элемента это обращение можно заменить на символ namespace содержит множество элементов относящихся тому или иному пространству имён то есть присутствует атрибут xmlns выражение определяющее отбираемые элементы рамках содержимого оси отбор выполняется согласно выражению определяющему отбираемые элементы качестве выражения может быть указано конкретное имя тогда отбираются элементы оси соответствующие этому имени указан символ что отберёт все элементы оси указано выражение составленное из функций тогда будут отобраны результаты вычисления выражения контексте каждого элемента оси функции делятся на групп функции над множествами узлов функция описание возвращает сам узел вместо этой функции часто используют заменитель но отличие от звёздочки функция node возвращает текстовые узлы возвращает узел если он текстовый возвращает множество из одного элемента который является текущим если мы делаем обработку множества предикатами то единственным способом дотянуться из этого предиката до текущего элемента будет данная функция возвращает позицию элемента множестве элементов оси корректно работает только цикле возвращает номер последнего элемента множестве элементов оси корректно работает только цикле возвращает количество элементов node set возвращает полное имя первого тега множестве возвращает ссылку на url определяющий пространство имён возвращает имя первого тега множестве без пространства имён находит элемент уникальным идентификатором строковые функции функция описание возвращает текстовое содержимое элемента по сути возвращает объединённое множество текстовых элементов на один уровень ниже соединяет строки указанные аргументах возвращает длину строки возвращает true если первая строка содержит вторую иначе false возвращает строку вырезанную из строки начиная указанного номера если указан второй номер количество символов если найдена вторая строка первой возвращает строку до первого вхождения второй строки если найдена вторая строка первой возвращает строку после первого вхождения второй строки возвращает true если вторая строка входит начало первой иначе false возвращает true если вторая строка входит конец первой иначе false убирает лишние повторные пробелы также управляющие символы заменяя их пробелами заменяет символы первой строки которые встречаются во второй строке на соответствующие позиции символам из второй строки символы из третьей строки например translate bar abc abc вернёт bar логические функции операторы символ оператор значение or логическое или and логическое логическое равно lt логическое меньше gt логическое больше lt логическое меньше либо равно gt логическое больше либо равно функция описание приводит объект логическому типу возвращает истину возвращает ложь отрицание возвращает истину если аргумент ложь наоборот числовые функции операторы символ оператор значение сложение вычитание умножение div обычное деление не нацело mod остаток от деления функция описание переводит объект число вернёт сумму множества каждый тег множества будет преобразован строку из него получено число возвращает наибольшее целое число не большее чем аргумент округление меньшему возвращает наименьшее целое число не меньшее чем аргумент округление большему округляет число по математическим правилам системные функции функция описание возвращает документ указанный параметре object форматирует число согласно образцу указанному во втором параметре третий параметр указывает именованный формат числа который должен быть учтён возвращает строку являющуюся уникальным идентификатором возвращает множество указанным ключом аналогично функции id для идентификаторов возвращает uri если такового нет возвращает пустую строку проверяет доступен ли элемент или множество указанное параметре параметр рассматривается как xpath проверяет доступна ли функция указанная параметре параметр рассматривается как xpath параметры возвращающие системные переменные могут быть xsl version возвращает версию xslt процессора xsl vendor возвращает производителя xslt процессора xsl vendor url возвращает url производителя если используется неизвестный параметр функция возвращает пустую строку возвращает true если текущего тега имеется атрибут xml lang либо родитель тега имеет атрибут xml lang нём указан совпадающий строке символ предикаты предикаты это логические выражения квадратных скобках составленные по тем же принципам что выражение отбора выражения возвращающие не логическое значение пустой набор элементов считаются ложными выражение возвращающее число считается выражением сравнивающим число position когда предикатов более одного каждый из них фильтрует результаты фильтрации предыдущим предикатом прочие обозначения xpath обозначение описание обозначает любое имя или набор символов по указанной оси например любой дочерний узел любой атрибут обращение переменной name имя переменной или параметра дополнительные условия выборки или предикат шага адресации должен содержать логическое значение если содержит числовое считается что это порядковый номер узла что эквивалентно приписыванию перед этим числом выражения position если применяется внутри тега другого языка например html то xslt процессор рассматривает содержимое фигурных скобок как xpath определяет уровень дерева разделяет шаги адресации объединяет результат рамках одного пути можно написать несколько путей разбора через знак результат такого выражения войдёт всё что будет найдено любым из этих путей ссылки xpath рекомендация xpath рекомендация xpath рекомендация xpath перевод рекомендации на русский язык xpath примерах xpath инъекции xpath javascript категория xml категория стандарты