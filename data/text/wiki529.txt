музыкальный диапазон стандарта midi midi цифровой интерфейс музыкальных инструментов стандарт цифровой звукозаписи на формат обмена данными между электронными музыкальными инструментами интерфейс позволяет единообразно кодировать цифровой форме такие данные как нажатие клавиш настройку громкости других акустических параметров выбор тембра темпа тональности др точной привязкой во времени системе кодировок присутствует множество свободных команд которые производители программисты пользователи могут использовать по своему усмотрению поэтому интерфейс midi позволяет помимо исполнения музыки управление другим оборудованием например осветительным пиротехническим midi команд может быть записана на любой цифровой носитель виде файла передана по любым каналам связи воспроизводящее устройство или программа называется синтезатором секвенсором midi фактически является автоматическим музыкальным инструментом история концу годов xx века получили распространение музыкальные синтезаторы они представляли собой наборы генераторов звуковых частот управляемых напряжением нажатие клавиши на клавиатуре синтезатора включало генератор частота которого задавалась напряжением от регулятора тональности данной клавиши количество отдельных генераторов определяло количество тонов синтезатора которые могут звучать одновременно конкретные модели синтезаторов могли иметь особенности звучания характерные специальные эффекты реализовать управление всей гаммой потенциальных возможностей синтеза звука рамках одного аналогового устройства было невозможно рабочее место музыканта того времени могло состоять из нескольких разнородных синтезаторов работать таким зоопарком было сложно начале годов необходимость увеличения гибкости управления разнородными синтезаторами стала очевидной развитие электроники подсказало путь решения проблемы цифровое программное управление компании производители синтезаторов удачно смогли договориться разработке поддержке единого стандарта на интерфейс управления синтезаторами который появился году идеология стандарта подразумевала разделение органов управления аппаратуры синтеза звука интерфейс midi фактически стал средством передачи положения клавиш регуляторов от музыкальной клавиатуры аппаратуре синтеза звука теперь музыкант мог одной клавиатуры управлять несколькими синтезаторами разных типов фирм изготовителей более того цифровой формат передачи позволил дополнить аппаратуру секвенсорами устройствами запоминающими наигранную мелодию теперь музыкант мог записывать композиции или их части микшировать без потери качества звука использования сложных студийных магнитофонов того времени стандарт быстро завоевал популярность постепенно дополняясь новыми возможностями он не потерял актуальности наше время стандарт на аппаратуру программное обеспечение схемотехника интерфейса физический уровень интерфейса представляет собой токовую петлю что обеспечивает гальваническую развязку безопасность при соединении устройств между собой передатчик активный ма наличие тока обозначает нет тока разъём штырьковый din асинхронный скорость кбит формат midi имеет шинную топологию источник данных например midi клавиатура имеет разъём выхода данных midi out который соединяется кабелем входом midi in первого синтезатора синтезатор имеет второй разъём midi thru на котором дублируется поток данных со входа это позволяет соединить цепочку произвольное количество синтезаторов синтезатор клавиатурой имеет все три разъёма in out thru интерфейс симплексный то есть источник сообщений например музыкальная клавиатура только передаёт никакой обратной связи не предусмотрено стандарт описывает аппаратный интерфейс который позволяет соединять электронные музыкальные инструменты компьютеры различных производителей описывает протоколы связи для передачи данных от одного устройства другому midi устройства могут программными приложениями используя протокол midi используя соответствующий программный midi секвенсор внешние midi устройства могут посылать информацию на синтезатор звуковой карты midi базируется на пакетах данных каждый из которых соответствует midi событию от нажатия клавиши до простой паузы эти события разделяются по каналам сложная среда midi может включать различную аппаратуру причём каждая часть системы будет отвечать за события на соответствующем канале альтернативным вариантом может быть одиночный синтезатор который сам может управлять всеми каналами формат музыкальных файлов отличие от других форматов это не оцифрованный звук наборы команд проигрываемые ноты ссылки на проигрываемые инструменты значения изменяемых параметров звука которые могут по разному зависимости от устройства воспроизведения удобство формата midi как формата представления данных позволяет реализовывать устройства производящие автоматическую аранжировку по заданным аккордам также приложения визуализации звука кроме того такие файлы как правило имеют на несколько порядков меньший размер чем оцифрованный звук сравнимого качества стандартный midi файл smf standard midi file это специально разработанный формат файлов предназначенный для хранения данных записываемых или исполняемых секвенсором секвенсор может быть как программой для компьютера так аппаратно выполненным модулем этом формате хранятся стандартные midi сообщения то есть статус байты соответствующие им байты данных также временные метки или маркеры для каждого сообщения то есть байтов указывающие какое количество условных единиц времени импульсов тиков необходимо подождать перед тем как исполнить следующее событие midi этот формат позволяет сохранять информацию темпе временном разрешении выраженном количестве тиков на одну четвертную длительность или во временных единицах приходящихся на одну секунду формате smpte обозначения размера информацию музыкальных ключах также хранить названия треков паттернов формат предусматривает возможность сохранения одном файле нескольких паттернов треков таким образом что программы приложения могут выбирать из всего набора хранимой информации ту которая будет понятна данному приложению как правило трек представляет собой аналог музыкальной партии например партии трубы аналогом паттерна может служить весь набор партий взятых вместе например совокупность партий трубы ударных фортепиано которые используются данном произведении или его части исполняются одновременно при разработке формата предусмотрели возможность для любого секвенсора читать записывать файл таким образом чтобы одной стороны не потерялись его данные другой стороны чтобы формат был достаточно гибким приложения могли сохранять файлах свою специфическую информацию понятную только им но не понятную другим программам приложениям причём при загрузке файлов midi непонятная другим программам приложениям информация не приводит недоразумениям просто игнорируется этом смысле формат файлов midi можно сравнить форматами текстовой информации различные программы секвенсоры способны читать midi файлы подобно тому как различные текстовые редакторы читают ascii файлы которые могут содержать вспомогательную информацию понятную лишь данному редактору но отличие от ascii файлов midi файлы содержат цифровую информацию тому же эта информация сохранена виде записей то есть групп байтов которые содержат свой заголовок состоящий из идентификатора записи длины записи эти записи могут форматироваться загружаться игнорироваться независимо друг от друга для осуществления работы записями программы приложения используют дополнительную информацию записываемую midi файл например возможно программа захочет сохранить флаг указывающий на то что пользователь установил включенным звук метронома программа может вставить этот флаг midi файл таким образом что другая программа приложение сможет пропустить этот флаг без внимания будущем возможно существующий формат midi будет расширен появятся новые типы записей новые программы для работы midi файлами будут распознавать новые типы записей однако старые midi файлы могут быть воспроизведены своем исходном виде формат midi задуман таким образом что его расширениями будут совместимы более ранние его версии что такое запись данные всегда хранятся виде записей одном midi файле могут сосуществовать несколько различных записей каждая запись может иметь свой собственный размер то есть количество байтов различных записях может быть различно данные хранящиеся одной записи связаны друг другом определённым образом запись это по своей сути набор взаимосвязанных байтов каждая запись начинается указания её идентификатора который состоит из четырёх букв то есть из четырёх ascii байтов этот идентификатор указывает какой тип записи представлен содержащихся записи байтах данных последующие за идентификатором четыре байта каждый из которых состоит из бит образуют битное значение указывающее длину или размер данной записи все записи должны начинаться этих двух полей идентификатора записи размера записи эти два поля занимающие всего байт образуют заголовок записи длина записи не учитывает байт заголовка байты длины просто указывают количество байтов записи которые следуют за заголовком приведём пример заголовка здесь байты представлены виде отметим что первые четыре байта заголовка образуют mthd то есть первыми четырьмя байтами заголовка являются ascii значения букв последующие байта говорят нам что записи будет ещё байтов следующих за заголовком после этих шести байтов должен следовать следующий заголовок записи или же конец midi файла фактически все midi файлы начинаются заголовка mthd именно этот факт является указанием на то что мы имеем дело со стандартным midi файлом запись mthd запись mthd имеет длину байт следует за идентификатором mthd битным числом рассмотрим подробно эти байтов следующих за байтным заголовком mthd записи первые два байта данных содержат информацию формате или типе midi файла существует три различных типа формата midi файлов тип означает что файл содержит midi данные записанные на одном треке который вероятно объединяет себе все midi каналов если ваш секвенсор сохраняет midi данные одном единственном блоке памяти из которого он их воспроизводит то такой секвенсор будет читать записывать midi данные именно этот тип midi файлов файл типа подразумевает что нём содержатся несколько но возможно всего один одновременно воспроизводимых треков каждый вероятно представляет свой собственный midi канал все треки начинают один тот же нулевой момент времени все треки взятые вместе образуют паттерн если ваш секвенсор разделяет памяти различные midi треки хранит их различных блоках воспроизводит различные треки одновременно то такой секвенсор будет читать писать файлы типа файлы типа содержат один или несколько независимых треков каждый такой трек образует свой собственный паттерн если ваш секвенсор разделяет midi данные на несколько блоков памяти но воспроизводит лишь один единственный блок данное время но не воспроизводит их одновременно когда каждый блок памяти содержит отдельную пьесу или её кусок то этот секвенсор будет читать записывать midi файлы второго типа следующие два байта определяют количество треков хранимых файле эти два байта обозначаются numtracks естественно что для файлов типа значение numtracks всегда равно для двух оставшихся типов возможны другие значения оставшиеся два байта указывают величину временного разрешения то есть количество временных импульсов временных тиков приходящихся на одну четвертную длительность что виде аббревиатуры английских слов обозначается как ppqn например если ваш секвенвер использует ppqn то соответствующее поле заголовке записи будет иметь значение напротив если первый байт поля заголовка отрицателен то соответствующий формат использует стандарт smpte вместо стандарта ppqt этом случае первый байт поля временного разрешения принимает значения или что соответствует четырём стандартным типам стандарте smpte второй байт положительная величина указывает величину разрешения во фрейме стандартные величины разрешения фрейма представляют собой временной код midi smpte или задавая значения фреймов величину разрешения можно установить значение временного разрешения длительностью миллисекунду ниже приводится пример целой записи типа mthd включая её заголовок mthd идентификатор длина записи mthd всегда равна байтам формат данного midi файла данном файле содержится записи типа mtrk the pulses per quarter note is запись mtrk за записью mthd следует mtrk запись это единственный тип записи отличающийся от mthd записи который определён для midi файлов настоящее время если по какой либо причине файле содержится идентификатор какой либо записи другого типа то вероятно эта запись создана для какой либо другой программы эта запись должна быть проигнорирована соответствии указанной её заголовке длиной данной записи mtrk запись содержит себе midi данные байты временных меток также необязательную информацию эти данные относятся одному треку очевидно что количество mtrk записей файле должно совпадать со значением numtracks указанном записи mthd заголовок записи mtrk начинается идентификатора записи который представляет собой четыре ascii байта за которым следует значение длины записи то есть число равное количеству байтов данной записи для различных треков значения длин mtrk записей могут быть различны например трек содержащий партию скрипки из концерта баха по всей видимости будет содержать больше данных чем трек содержащий басовую партию которой на один такт приходится лишь две ноты величины переменной длины временные метки событий трек midi файле аналогичен треку midi секвенсоре трек секвенсора содержит событий например первым событием может быть взятие ноты до первой октавы вторым событием может быть взятие ноты ми терцией выше эти два события могут произойти одно то же время третьим событием может быть снятие ноты до это событие может произойти несколькими долями позже после первого события то есть звук до будет снят спустя несколько долей после того как он был взят для каждого события указывается его время именно этот момент времени событие происходит все события организованы пределах одной записи памяти секвенсора порядке их появления во времени midi файле время события указывается перед байтами данных которые описывают само событие иными словами временна метка события предшествует описанию события например если первое событие происходит спустя временных интервала временной интервал устанавливается mthd записи после начала воспроизведения то соответствующее ему значение дельта значение промежутка времени устанавливается равным если следующее событие происходит одновременно этим первым событием то значение его времении дельта равно таким образом время дельта это длительность выраженная элементарных временных интервалах между данным событием ему предшествующим событием поскольку предполагается что все треки начинают момента времени равного то время дельта первого события становится равным значения времен дельта хранятся виде байтов которые носят название величин переменной длины лишь первые бит каждого байта являются значимыми для определения дельта времени если время дельта выражено виде набора бит то необходимо распаковать эту байтовую величину выделив четырёх битных значимых байтов наподобие того как это делается для передачи sysex сообщений рамках протокола midi зависимости от величины времени дельта количество байтов может быть различным для того чтобы отметить последний байт этих байтов необходимо оставить бит этого последнего байта чистым старший бит равен так если время дельта находится пределах от до то оно может быть выражено одним единственным байтом самое большое время дельта устанавливается размере fffffff для записи такого времени потребуется величина переменной длины размером байта так могут выглядеть величины переменной длины для разных значений времен дельта время дельта выражено виде битного значения время дельта соответствующая величина переменной длины fff ff fffff ff ff fffffff ff ff ff отметим что использование значений переменной длины то есть разбиение большой величины на байтов не ограничивается случаем временами дельта значения переменный длины используются midi файлах других случаях события первые байты байт или байты по записи mtrk задают значение времени дельта для первого события формате величины переменной длины следующий за этой величиной байт данных представляет собой первый байт события midi это байт носит название байта статуса события или байта текущего midi статуса для midi событий он представляет собой статус байт данного события например если этот байт равен то данное событие это событие взять ноту на midi канале или если этот байт равен то необходимо обратиться статус байту предыдущего события очевидно что первое midi событие mtrk записи обязательно должно содержать себе статус байт после статус байта следуют один или два байта данных зависимости от типа события после этих байтов данных находится следующее значение времени дельта виде величины переменной длины начинается процесс прочтения следующего события особый случай представляют собой сообщения sysex имеющие статус байт равный события sysex могут иметь любую длину после статус байта следует значений переменной длины можно получить битовое значение которое равно количеству следующих далее байтов образующих sysex событие эта длина не включает себя статус байт рассмотрим качестве примера следующее sysex событие midi midi файле такое событие будет сохранено виде следующей байтов исключая время дельта предшествующее событию статус байт ff зарезервирован для использования качестве статуса события не являющегося midi событием за байтом ff следует другой байт указывающий какой тип не midi события описывается данном событии это своеобразный второй статус байт за этим байтом следует величина переменной длины которая показывает какое количество байтов содержится данном событии то есть задаёт длину события длина не включает себя начальный статус байт ff байт типа события байты длины события это особое сообщение не принадлежащее протоколу midi носит название мета события ниже описаны некоторые мета события если не указано обратное записи mtrk может быть размещено более одного мета события причём одно то же мета событие может быть размещено одной записи более одного раза мета события могут иметь произвольные временные метки времена дельта как все midi события мета события имеют дельта времена временные метки которые указывают промежуток времени разделяющий данное midi событие или мета событие от предшествующего независимо от того является это событие midi событием или мета событием таким образом мы можем произвольно смешивать midi события мета события номер записи ff ss ss это необязательное мета событие должно находиться самом начале mtrk записи перед первой ненулевой временной меткой или перед первым событием это мета событие устанавливает номер номер записи два байта данных ss ss соответствуют данным midi сообщении midi cue midi файлах второго типа эти числа определяют номера каждого паттерна или mtrk записи таким образом что пьес содержащихся файле может быть управляема при помощи сообщения midi cue если байты ss ss опущены длина данного мета сообщения равна вместо то номера mtrk записей устанавливаются порядке того как они записаны файле первая mtrk соответствует первому треку файлы нулевого первого типов которые содержат единственный паттерн могут содержать мета сообщение номера только первой mtrk записи несколько файлов первого типа содержащих различные номера могут рассматриваться как коллекции независимых пьес можно использовать только одно мета сообщение номера для каждого mtrk записи файле формата можно использовать только одно мета сообщение номера файле формата им формата это мета сообщение должно находиться первой mtrk записи текст ff len text это мета событие содержит любой объём текста любого назначения значение len содержит длину текстового сообщения байтах наиболее удобно помещать такие мета сообщения начале mtrk записи несмотря на то что записываемый текст может быть использован любых целях необходимо иметь виду что предусмотрены также иные текстовые мета сообщения которые специально предназначены для указания инструментов оркестра слов песен названий треков другие данное мета событие главным образом предназначено для добавления комментариев midi файлу предполагается что при загрузке файлов эти комментарии будут проигнорированы отметим что величина len представляется виде значения переменной длины мета событие copyright ff len text текстовое мета событие copyright наиболее удобно помещать начале mtrk записи отметим что величина len представляется виде значения переменной длины имя имя трека ff len text текстовое мета событие содержащее название midi или трека удобно располагать это мета событие начале mtrk записи отметим что величина len представляется виде значения переменной длины инструмент ff len text текстовое мета событие содержащее название инструмента исполняющего данный трек название инструмента может отличаться от названия самого трека например название трека может быть скажем ария ленского название инструмента может указывать на голос содержать значение тенор наиболее удобно располагать одно или несколько мета событий подобного типа самом начале mtrk записи поскольку эти события несут вспомогательную информацию которая информирует пользователя том какой инструмент исполняет данный трек также сообщают другие полезные данные обычно реальные параметры задающие тип инструмента исполняющего трек хранятся файле виде midi событий типа midi program change описанные здесь мета события позволяют снабдить пользователя удобно читаемыми описаниями сделанным mtrk записях конфигурациям отметим что величина len представляется виде значения переменной длины слова ff len text текстовое мета событие содержащее слова вокального произведения приходящиеся на ту или иную музыкальную долю одно мета событие слова должно содержать один единственный слог текста отметим что величина len представляется виде значения переменной длины маркер ff len text текстовое мета событие маркер устанавливается на определённой музыкальной доле это событие может использоваться для организации петель может обозначать начальную конечную точку петли отметим что величина len представляется виде значения переменной длины точка входа cue point ff len text текстовое мета событие точка входа может использоваться для обозначения точки входа внешнего потока данных например точки начала воспроизведения файла цифровым звуком текстовое значение данного мета события может содержать имя wav файла содержащего цифровой звук отметим что величина len представляется виде значения переменной длины канал midi ff cc это необязательное мета событие обычно располагается начале mtrk сообщения перед первой ненулевой временной меткой перед первым мета событием исключая мета событие номера мета событие канал midi устанавливает значение midi канала которым будут связаны все последующие мета события события sysex байт данных cc это номер midi канала величине соответствует первый канал спецификация midi не предусматривает указание номера канала для sysex событий мета событий если создаётся файл типа то все sysex события мета события находятся на одном треке затруднительно распределить эти события между канальными голосовыми сообщениями например если вы хотите обозначить партию канала как флейта соло партию канала как труба соло то вам придётся использовать два мета события имя трека для введения этих названий но поскольку оба этих трека расположены на одном канале то перед первым мета сообщением имени трека необходимо поместить мета сообщение канал midi котором указать номер канала перед вторым мета сообщением имени трека поместить мета сообщение канала midi указанием номера второго канала на одном midi треке можно использовать более одного мета сообщения канал midi если события этого трека нужно распределить между несколькими каналами midi порт midi ff pp это необязательное событие которое как правило располагается начале записи mtrk перед первым ненулевым временем дельта перед первым midi событием которое определяет каким midi портом или устройством связаны события данного mtrk сообщения байт данных pp это номер порта нулевому значению pp соответствует первое midi устройство системе спецификация midi предусматривает лишь каналов на один входной или выходной порт устройство разъём инструмент терминология может быть различной midi номер midi канала каждого события midi содержится статус байте события где он занимает четыре младших бита таким образом номер канала всегда представляет собой число пределах от до иногда система позволяет осуществлять работу более чем каналами midi возникает необходимость преодолеть ограничения накладываемые малым количеством каналов midi расширить возможности обмена midi данными сделать обмен информацией со внешними midi устройствами более эффективным то есть позволить музыканту работать более чем каналами некоторые секвенсоры также позволяют осуществлять работу более чем midi каналами на входе выходе одновременно сожалению протокол midi не предусматривает возможность использования более чем midi каналов рамках статус байта событии midi поэтому необходим дополнительный метод который позволяет различать события которые соответствуют первому каналу на первом midi порте от событий соответствующих скажем первому каналу на втором midi порте описываемой мета событие позволяет секвенсору определить на какой midi порт посылать события данного mtrk сообщения допускается располагать более одного мета события порт midi пределах одного midi трека если требуется изменить значение midi порта определённый момент времени темп ff tt tt tt это событие указывает на изменение темпа байта данных tt tt tt определяют темп микросекундах четвертной ноте другими словами значение темпа мкс говорит вам сколько времени должна звучать каждая из четвертных нот если tt tt tt то каждая четвертная нота должна иметь длительность или микросекунд проверьте вашим калькулятором windows научном режиме как правило музыканты выражают темп как сумму четвертных нот каждую минуту то есть период времени это полностью противоположно тому как формат midi выражает его чтобы преобразовать темп midi формат bpm ударов минуту bpm tt tt tt например темп bpm микросекунд за четвертную ноту примечание если темп не определён по умолчанию предполагается значение bpm smpte offset ff hr mn se fr ff назначает smpte время начала часы минуты секунды кадры субкадры трека midi designates the smpte start time hours minutes secs frames subframes of the midi track time signature размер ff nn dd cc bb музыкальный размер задаётся четырьмя байтами nn dd соответственно числитель знаменатель нотной записи знаменатель вычисляется как двойка степени dd dd dd cc expresses the number of midi clocks in metronome click bb expresses the number of notated nd notes in midi quarter note midi clocks this event allows program to relate what midi thinks of as quarter to something entirely different for example time with metronome click every eighth notes and clocks per quarter note would be the following event ff note if no time signature is defined the default value is assumed time signature can only be redefined at measure beginnings key signature тональность ff sf mi sf для бемолей для бемоля для до мажора или натурального ля минора для диеза mi для мажора для минора конец трека ff это событие является обязательным оно обязано быть последним событием каждой mtrk записи оно представляет собой явное обозначение конца mtrk записи допускается использование единственного мета события конец трека для каждой mtrk записи улучшение звучания midi файлы midi являются набором команд для синтезатора секвенсора установленного на компьютере но не несут себе готовых для воспроизведения аудиоданных часто звучание установленного по умолчанию на компьютере программного синтезатора не устраивает пользователя из за качества семплов банке звуков синтезатора для улучшения звука можно установить другой midi синтезатор банком лучшего качества или же использующий отличный от волнового способ формирования звука например физический преобразование midi для преобразования музыкальных записей команды midi существуют различные программы качестве исходных могут использоваться как wav файлы так файлы формата mp дорожки audio cd также непосредственно поступающий микрофона звук без записи его файл некоторые программы умеют распознавать полифоническую музыку то есть содержащую много голосов для улучшения качества распознавания некоторых программах можно использовать встроенный нотный редактор midi культура см также midi клавиатура midi контроллер midi port gameport midi редактор нотный редактор секвенсор синтезатор список аудиоформатов файлов general midi примечания ссылки наиболее полная спецификация midi на русском статей описание стандартов midi описание интерфейса midi технические спецификации midi чёрные миди black midi категория шины