логотип bittorrent bittórrent букв битовый поток пиринговый сетевой протокол для кооперативного обмена файлами через интернет файлы передаются частями каждый torrent клиент получая скачивая эти части то же время отдаёт закачивает их другим клиентам что снижает нагрузку зависимость от каждого клиента источника обеспечивает избыточность данных протокол был создан брэмом коэном написавшим первый torrent клиент bittorrent на языке python апреля года запуск первой версии состоялся июля года существует множество других программ клиентов для обмена файлами по протоколу bittorrent файл метаданных файл метаданных является словарём bencode формате расширением torrent содержит информацию раздаче файлах трекерах др принцип работы протокола принцип работы bittorrent нагрузка на файла уменьшается благодаря тому что клиенты начинают обмениваться данными сразу же даже если файл не докачан ими до конца перед началом скачивания клиент подсоединяется трекеру по адресу указанному торрент файле сообщает ему свой адрес хеш сумму торрент файла на что ответ клиент получает адреса других клиентов скачивающих или раздающих этот же файл далее клиент периодически информирует трекер ходе процесса получает обновлённый список адресов этот процесс называется объявлением клиенты соединяются друг другом обмениваются сегментами файлов без участия трекера который лишь хранит информацию полученную от подключенных обмену клиентов список самих клиентов другую статистическую информацию для эффективной работы сети bittorrent необходимо чтобы как можно больше клиентов были способны принимать входящие соединения неправильная настройка nat или брандмауэра могут этому помешать при соединении клиенты сразу обмениваются информацией об имеющихся них сегментах клиент желающий скачать сегмент личер посылает запрос если второй клиент готов отдавать получает этот сегмент после этого клиент проверяет контрольную сумму сегмента если она совпала той что записана торрент файле то сегмент считается успешно скачанным клиент оповещает всех присоединённых пиров наличии него этого сегмента если же контрольные суммы различаются то сегмент начинает скачиваться заново некоторые клиенты банят тех пиров которые слишком часто отдают некорректные сегменты таким образом объём служебной информации размер торрент файла размер сообщений со списком сегментов напрямую зависит от количества значит размера сегментов поэтому при выборе сегмента необходимо соблюдать баланс одной стороны при большом размере сегмента объём служебной информации будет меньше но случае ошибки проверки контрольной суммы придётся заново скачивать больше информации другой стороны при малом размере ошибки не так критичны так как необходимо заново скачать меньший объём но зато размер торрент файла сообщений об имеющихся сегментах становится больше алгоритм обмена данными каждый клиент имеет возможность временно блокировать отдачу другому клиенту это делается для более эффективного использования канала отдачи кроме того при выборе кого разблокировать предпочтение отдаётся пирам которые сами передали этому клиенту много сегментов таким образом пиры хорошими скоростями отдачи поощряют друг друга по принципу ты мне тебе обмен сегментами ведётся по принципу ты мне тебе симметрично двух направлениях клиенты сообщают друг другу об имеющихся них сегментах при подключении затем при получении новых сегментов поэтому каждый клиент может хранить информацию том какие сегменты есть других подключенных пиров порядок обмена выбирается таким образом чтобы сначала клиенты обменивались наиболее редкими сегментами таким образом повышается доступность файлов раздаче то же время выбор сегмента среди наиболее редких случаен поэтому можно избежать ситуации когда все клиенты начинают скачивать один тот же самый редкий сегмент что негативно бы отразилось на обмен данными начинается когда обе стороны нём заинтересованы то есть каждая из сторон имеет сегменты которых нет другой количество переданных сегментов подсчитывается если одна из сторон обнаруживает что передаёт среднем больше чем принимает она блокирует на некоторое время отдачу другой стороне таким образом протокол заложена защита от личеров сегменты делятся на блоки размером килобайт каждый клиент запрашивает именно эти блоки одновременно могут запрашиваться блоки из разных сегментов более того некоторые клиенты поддерживают скачивание блоков одного сегмента разных пиров этом случае описанные выше алгоритмы механизмы обмена применимы уровню блоков режим end game когда скачивание почти завершено клиент входит особый режим называемый end game этом режиме он запрашивает все оставшиеся сегменты всех подключенных пиров что позволяет избежать замедления или полного зависания почти завершенной закачки из за нескольких медленных клиентов спецификация протокола не определяет когда именно клиент должен войти режим end game однако существует набор общепринятых практик некоторые клиенты входят этот режим когда не осталось незапрошенных блоков другие пока количество оставшихся блоков меньше количества передающихся не больше существует негласное мнение что лучше поддерживать количество ожидаемых блоков низким или для минимизации избыточности что при случайном запрашивании меньший шанс получить дубликаты одного того же блока сидирование при получении полного файла клиент переходит специальный режим работы котором он только отдаёт данные становится сидом далее сид периодически информирует трекер об изменениях состоянии торрентов закачек обновляет списки ip адресов общие особенности отсутствие очередей на скачивание файлы закачиваются небольшими фрагментами чем менее доступен фрагмент тем чаще он будет передаваться таким образом присутствие сети сидера полным файлом для загрузки необязательно система распределяет сегменты между пирами чтобы последующем они могли обмениваться недостающими сегментами клиенты peers обмениваются сегментами непосредственно между собой по принципу ты мне тебе скачанные фрагменты становятся немедленно доступны другим клиентам контролируется целостность каждого фрагмента на фрагменты разбиваются не отдельные файлы вся раздача целиком поэтому личера пожелавшего скачать лишь некоторые файлы из раздачи для поддержания целостности фрагментов нередко будет храниться также небольшой объём избыточной для него информации качестве объекта раздачи могут выступать несколько файлов например содержимое каталога протоколы порты клиенты соединяются трекером по протоколу tcp наиболее часто используемый входящий порт трекера наиболее часто используемый диапазон входящих портов клиентов номера портов не фиксированы спецификации протокола могут изменяться при необходимости данный момент большинство трекеров используют обычный http порт для клиентов рекомендуется выбрать случайный входящий порт более того некоторые трекеры не допускают использование портов клиентов из стандартного диапазона так как некоторые провайдеры запрещают использование этого диапазона портов dht сеть bittorrent клиентах использует протокол udp кроме того протокол udp используется поддерживается не всеми клиентами не является официальной частью протокола для соединения клиентов друг другом через udp nat traversal используется только клиенте bitcomet не является официальной частью протокола трекер трекер сервер работающий по протоколу http трекер нужен для того чтобы клиенты могли найти друг друга фактически на трекере хранятся ip адреса входящие порты клиентов хеш суммы уникальным образом объекты участвующие закачках по стандарту имена файлов на трекере не хранятся узнать их по хеш суммам нельзя однако на практике трекер часто помимо своей основной функции выполняет функцию небольшого веб сервера такой сервер хранит файлы метаданных описания файлов предоставляет статистику закачек по разным файлам показывает текущее количество подключённых пиров пр работа без трекера новых версиях протокола были разработаны бестрекерные системы которые решают некоторые из предыдущих проблем отказ трекера таких системах не приводит автоматическому отказу всей сети начиная версии официального клиента выпущенной конце года реализована функция бестрекерной работы базирующаяся на dht kademlia такой реализации трекер доступен на клиентах форме распределённой хеш таблицы на данный момент не все клиенты используют совместимый друг другом протокол совместимы между собой bitcomet µtorrent deluge ktorrent transmission qbittorrent официальный клиент bittorrent vuze azureus также имеет режим бестрекерной работы но его реализация отличается от официальной вследствие чего он не может работать через dht клиентами однако для vuze существует поддержка стандартного dht через плагин mainline dht работа без трекера также возможна при использовании клиентов поддерживающих bittorrent shareaza через сеть gnutella обменивается хешами адресами пиров других поддерживаемых сетей том числе bittorrent greylink планируется поддержка bittorrent при этом сеть direct connect может использоваться не только для преобразования tth но для поиска пиров работа без торрент клиента для того чтобы брать раздавать файлы торрент сетях не обязательно пользоваться специальными программами существуют несколько сервисов которые позволяют скачивать файлы используя только браузер наличие файлах метаданных дополнительной информации такой как дополнительные источники опциональные хеши позволяет использовать файл метаданных torrent аналогично форматам metalink magma список файлов direct connect клиент shareaza использует опциональные хеши для поиска альтернативных источников других сетях web сиды одним из вариантов использования является так называемое web сидирование иногда на сервере по разным причинам нельзя запустить полноценный торрент клиент этом случае качестве источника раздачи выступает сервер работающий по протоколу http как правило клиенты отдают предпочтение другим bittorrent клиентам обращаются web сиду только по необходимости следует знать что реализован этот вариант использования как минимум тремя способами bep bittornado style webseeding bep getright style webseeding external sourcing каждый из которых отличается деталях реализации впервые был создан джоном theshad хоффманом который создал bittornado начиная версии клиент bittorrent поддерживает веб сиды загрузки веб сайтов был создан простой инструмент который создает публикации веб сидов торрентов μtorrent добавлена поддержка для получения веб сидов версии bitcomet добавлена поддержка для получения веб сидов версии btih bittorrent info hash это sha хеш поля info из файла метаданных данный хеш используется магнет ссылках также для идентификации на трекере между клиентами при загрузке на трекер файла метаданных его info hash может измениться так как трекер может изменить поле info установив флаг закрытой раздачи private или изменив добавив поля внутри info поэтому необходимо снова скачать файл метаданных файл torrent трекера добавить его клиент btc ссылка указывается виде btc адрес порт peer id btih ссылка такого вида ссылается на раздачу на её источник поддерживается shareaza недостатки ограничения недоступность раздачи случае если раздача непопулярна то может возникнуть ситуация когда нет ни одного сида данных присутствующих пиров не хватает чтобы завершить скачивание таком случае необходимо ждать появления либо сида либо пира имеющего сегменты отсутствующие остальных можно также использовать копии файлов полученные другим путём раздача которая не имеет ни одного сида долгое время называется мёртвой отсутствие анонимности персонализации принцип работы bittorrent протокола подразумевает что каждому клиенту известны ip адреса как минимум других клиентов полученные от сервера использование разнообразных расширений протокола некоторых случаях позволяет узнать также адреса других пиров из роя поэтому пользователи незащищённых систем клиентов известными уязвимостями могут быть подвергнуты атаке возможно узнать адреса пользователей передающих или принимающих определённый файл проблема анонимностью может быть решена при помощи использования tor bittorrent клиент vuze имеет встроенную программную поддержку этой анонимной сети но данный метод не является стопроцентно эффективным другой стороны протокол не предполагает использование ников отсутствует чат между пирами невозможно просмотреть список файлов пира поисках других файлов которые могли бы заинтересовать большинство этих функций реализовано других протоколах например direct connect проблема личеров некоторые пользователи особенно на трекерах не требующих регистрации не поддерживают раздачу после завершения скачивания что ведёт уменьшению общей поэтому некоторые торрент трекеры учитывают количество скачанного отданного выдают разрешение на скачивание зависимости от размера отданных клиентом данных отсутствие точного учёта трафика отличие от многих коммерческих протоколов дистрибуции медиаконтента архитектура протокола не предусматривает точного механизма учёта контроля трафика между точками сети всё что есть поля downloaded uploaded которых клиенты передают при анонсе трекеру количество байт учтенных при скачивании загрузке данных момента предыдущего анонса однако не контролируясь никем кроме как клиентом они могут быть легко подменены для этого пользователи статично прописывают значения этих полей uri трекера пользуются патчами для клиентов или же отдельными программами ratiomaster givemetorrent greedytorrent либо просто удаляют из клиента запись трекере сразу же после получения трекера списка точек сети всё это позволяет обходить искусственные ограничения создаваемые администрацией многих частных публичных трекеров терминология анонс обращение клиента трекеру посредством http get запроса при каждом анонсе клиент передаёт на трекер информацию об объёмах им скачанного отданного трекер передаёт клиенту список адресов других клиентов обращение клиента трекеру происходит через определённые интервалы времени которые определяются настройками клиента трекера веб сид http или ftp сервер используемый качестве источника данных наравне обычными сидами доступность копии количество полных копий файла доступных клиенту каждый сид добавляет этому числу личеры увеличивают доступность зависимости от количества скачанного которого нет других личеров примеру если на раздаче есть один сид два личера скачавшие по файла скачанные части равны между собой то доступность равна заглохший заглохший придушенный клиент обмен данными которым заглох либо его канал на выход забит полностью он не может ничего передать достиг max_uploads либо он является сидом ему ничего не нужно получать участник желающий получить куски файла имеющиеся другого участника например если клиента нет каких то частей которые есть клиента считается что клиент заинтересован обмене клиентом излишки данные которые были посланы пиром или сидом но получатель них не нуждается излишкам также относятся ошибки хеша индекс это список torrent файлов обычно включающий описания другую информацию управляемый веб сайтом индексатором доступный для поиска индексирующий сайт часто ошибочно называют трекером личер его рой лич иногда личер пиявка пир не имеющий пока всех сегментов то есть продолжающий скачивание термин часто употребляется негативном смысле который он имеет других файлообменных сетях пользователь который отдаёт гораздо меньше чем скачивает отравленный торрент ситуация когда часть пиров раздаёт повреждённые либо специально сегменты пир соучастник клиент участвующий раздаче пренебрегающий клиент подключённый получателю но не посылавший ему данные уже более секунд раздача процесс распространения файла по протоколу bittorrent рейтинг отношение отданного скачанному рой совокупность всех пиров участвующих раздаче сегмент часть все файлы для передачи делятся на небольшие куски сегменты которые затем передаются по сети произвольном порядке для оптимизации обмена сид иногда сидер сеятель пир имеющий все сегменты файла то есть либо начальный файла либо уже скачавший весь файл оставшийся на раздаче scrape запрос англ scrape скрести царапать дополнительный протокол запроса клиента трекеру при котором трекер сообщает клиенту общее количество сидов пиров на раздаче отличие от анонсирования запрос scrape не имеет прямого отношения скачиванию раздачи является необязательным отнимает меньше ресурсов клиента трекера он может запрашиваться для остановленных клиенте заданий также позволяет одним запросом получить информацию сразу по нескольким торрентам multi scrape клиент помощью scrape запроса может получить точное количество сидов пиров на каждом задании включая остановленные некоторые клиенты например azureus также могут помощью scrape запроса раньше узнать том что на раздаче появились дополнительные участники сделать внеочередной announce для получения их адресов автоматически останавливать запускать сидирование заданий зависимости от числа сидов пиров результате сидируя там где это нужнее супер сидирование специальный режим раздачи некоторых bittorrent клиентах пытающийся минимизировать количество данных которое отдаст раздающий до появления первого скачавшего суперсид предлагает каждому пиру скачать только один сегмент файла которого ещё нет других пиров затем сид не даёт этому пиру следующих сегментов пока не получит от других пиров подтверждения что они тоже получили этот сегмент таким образом суперсид пытается избежать повторной отдачи одних тех же сегментов старается отдавать сегменты только тем пирам которые активно передают их другим хеш sha отдельных сегментов оригинальных файлов перечисленных словаре info torrent файла каждая часть после получения сначала проверяется на совпадение хеша если проверка не удалась данные отбрасываются запрашиваются ещё раз также протоколе используется хеш самого словаря info инфохеш выступающий роли идентификатора конкретной раздачи при обращении трекеру другим точкам сети при составлении magnet ссылок он содержат base представление инфохеша passkey аутентификатор пользователя на неанонимных трекерах содержится скачиваемом torrent файле таким образом если кто то получит доступ torrent файлу например пользователь по неосторожности расшарил его он сможет работать трекером от имени этого пользователя трекер может изменить passkey по запросу пользователя но при этом необходимо будет перескачать все прошлые torrent файлы или вручную отредактировать их чтобы иметь возможность дальше раздавать скачанные файлы url анонса адрес трекера которому клиент делает анонс во многих клиентах называется tracker url может включать passkey уникальный код назначаемый трекером для аккаунта пользователя помогающий его на трекере добавляется url анонса самом torrent файле при скачивании см также сравнение программного обеспечения bittorrent трекеров примечания ссылки официальный сайт bittorrent текущая спецификация протокола bittorrent категория bittorrent категория файлообменные сети категория файлообменные протоколы категория протоколы прикладного уровня