rdtsc ассемблерная инструкция для платформ читающая счётчик tsc возвращающая регистрах edx eax битное количество тактов момента последнего сброса процессора rdtsc поддерживается процессорах pentium совместимых ними более новых опкод rdtscp поддерживается начиная intel nehalem amd family опкод использование rdtsc чаще всего используется для измерения времени для точного измерения временных интервалов том числе при проведении оптимизации измерение времени необходимого для выполнения конкретных инструкций или их набора антиотладочных целях как источник энтропии для генераторов псевдослучайных чисел преимущества сравнении операционными системами api вроде winapi или gettimeofday инструкции rdtsc rdtscp могут предоставлять следующие преимущества более высокая точность особенно случае архитектур устаревших операционных систем не имеющих полноценной поддержки hpet такие ос используют системный таймер невысокой точности иногда до слайса планировщика ostimeslice порядка единиц десятков миллисекунд меньшие накладные расходы инструкции rdtsc rdtscp исполняются за время порядка десятка тактов что значительно быстрее выполнения системных вызовов не требуют переключения режим ring или гипервизор большинстве систем если команда разрешена данной ос проблемы использования rdtsc rdtscp потенциально может быть недоступна или запрещена использованию на конечной системе где будет использоваться приложение поэтому должны быть предусмотрены режимы работы программ не требующие данной команды точные замеры могут быть невозможны при однократном исполнении измеряемого фрагмента инструкций из за влияния кэшей процессора при обращении памяти традиционно решается многократным измерением фрагмента программы или повторением измеряемого фрагмента цикле rdtsc может замеряемыми командами на out of order процессорах можно запретить добавлением сериализующих команд например cld clc для pentium моделей или cpuid для более новых или использованием rdtscp инструкции могут быть недоступны на очень старых процессорах например либо на системах реализующих архитектуру не полном объеме инструкция может быть потенциально превращена операционной системой установлен бит управляющем регистре cr её использование приведет генерации исключения программе инструкцию могут перехватывать системы виртуализации её использование будет приводить гипервызову режим может влиять на подсчет тактов современных процессорах intel счетчик tsc не зависит от использования технологий увеличивается на каждый такт вне зависимости от того работал ли процессор или находился состоянии сна при динамическом изменении частоты процессором снижения повышения частоты технологиях cool quiet turbo boost подобных измерения длительности коротких фрагментов могут быть нестабильными многоядерных системах или при использовании hyperthreading из за взаимного влияния со стороны других потоков загруженности разделяемых процессорных блоков счетчики tsc редких случаях могут быть некоторых многоядерных или системах частности при инициализации процессоров возможна счётчиков ранних многоядерных системах из за неверной инициализации процессоров некоторыми bios исправляется обновлением bios или обновлением операционной системы существуют программы для проверки на наличие этой ошибки операционная система может переключать поток между разными ядрами имеющими не счетчики на прикладном уровне можно отследить факт смены ядра на многоядерных системах при помощи инструкции rdtscp которая работая аналогично rdtsc дополнительно возвращает регистре ecx номер процессорного ядра для решения многих проблем рекомендуется фиксирование потока на конкретном процессоре cpu affinity отключение технологий автоматического изменения частоты технологий динамического изменения примечания ссылки intel and ia architectures software developer manual volume instruction set reference стр полезная статья performance measurements with rdtsc категория инструкции