многопото чность свойство платформы например операционной системы виртуальной машины или приложения состоящее том что процесс порождённый операционной системе может состоять из нескольких потоков выполняющихся параллельно то есть без предписанного порядка во времени при выполнении некоторых задач такое разделение может достичь более эффективного использования ресурсов вычислительной машины такие потоки называют также потоками выполнения от иногда называют нитями буквальный перевод или неформально тредами описание сутью многопоточности является на уровне одного исполняемого процесса то есть все потоки выполняются адресном пространстве процесса кроме этого все потоки процесса имеют не только общее адресное пространство но общие дескрипторы файлов выполняющийся процесс имеет как минимум один главный поток многопоточность как доктрину не следует путать ни ни несмотря на то что операционные системы реализующие многозадачность как правило реализуют многопоточность достоинствам многопоточной реализации той или иной системы перед многозадачной можно отнести следующее упрощение программы некоторых случаях за счёт использования общего адресного пространства меньшие относительно процесса временны затраты на создание потока достоинствам многопоточной реализации той или иной системы перед однопоточной можно отнести следующее упрощение программы некоторых случаях за счёт вынесения механизмов чередования выполнения различных слабо взаимосвязанных подзадач требующих одновременного выполнения отдельную подсистему многопоточности повышение процесса за счёт процессорных вычислений операций ввода вывода случае если потоки выполнения требуют относительно сложного взаимодействия друг другом возможно проявление проблем многозадачности таких как взаимные блокировки аппаратная реализация на обычном процессоре управление потоками осуществляется операционной системой поток исполняется до тех пор пока не произойдёт аппаратное прерывание системный вызов или пока не истечёт отведённое для него операционной системой время после этого процессор переключается на код операционной системы который сохраняет состояние потока его контекст или переключается на состояние другого потока которому тоже выделяется время на исполнение при такой многопоточности достаточно большое количество тактов процессора тратится на код операционной системы переключающий контексты если поддержку потоков реализовать аппаратно то процессор сам сможет переключаться между потоками идеальном случае выполнять несколько потоков одновременно за каждый такт для операционной системы пользователя один такой физический процессор будет виден как несколько логических процессоров различают две формы многопоточности которые могут быть реализованы процессорах аппаратно временная многопоточность англ temporal multithreading одновременная многопоточность англ simultaneous multithreading типы реализации потоков поток пространстве пользователя каждый процесс имеет таблицу потоков аналогичную таблице процессов ядра недостаткам можно отнести отсутствие прерывания по таймеру внутри одного процесса при использовании блокирующего системного запроса для процесса все его потоки блокируются сложность реализации поток пространстве ядра наряду таблицей процессов пространстве ядра имеется таблица потоков волокна несколько потоков режима пользователя исполняющихся одном потоке режима ядра поток пространства ядра потребляет заметные ресурсы первую очередь физическую память диапазон адресов режима ядра для стека режима ядра поэтому было введено понятие волокна облегчённого потока выполняемого исключительно режиме пользователя каждого потока может быть несколько волокон взаимодействие потоков многопоточной среде часто возникают задачи требующие приостановки возобновления работы одних потоков зависимости от работы других частности это задачи связанные предотвращенем конфликтов доступа при использовании одних тех же данных или устройств из параллельно исполняемых потоков для решения таких задач используются специальные объекты для взаимодействия потоков такие как мьютексы семафоры критические секции события многие из этих объектов являются объектами ядра могут применяться не только между потоками одного процесса но для взаимодействия между потоками разных процессов mutex мьютекс это объект синхронизации который устанавливается особое сигнальное состояние когда не занят каким либо потоком только один поток владеет этим объектом любой момент времени отсюда название таких объектов от английского mut ually ex clusive access взаимно исключающий доступ одновременный доступ общему ресурсу исключается после всех необходимых действий мьютекс освобождается предоставляя другим потокам доступ общему ресурсу объект может поддерживать рекурсивный захват второй раз тем же потоком увеличивая счётчик не блокируя поток требуя потом многократного освобождения такова например критическая секция win тем не менее есть такие реализации которые не поддерживают такое приводят взаимной блокировке потока при попытке рекурсивного захвата например это fast_mutex ядре windows критические секции обеспечивают синхронизацию подобно мьютексам за исключением того что объекты представляющие критические секции доступны лишь пределах одного процесса события мьютексы семафоры также можно использовать потоках однопроцессного приложении однако реализации критических секций некоторых ос например windows nt обеспечивают более быстрый более эффективный механизм взаимно исключающей синхронизации операции получить освободить на критической секции оптимизированы для случая единственного потока отсутствия конкуренции целью избежать любых ведущих ядро ос системных вызовов семафоры представляют собой доступные ресурсы которые могут быть приобретены несколькими потоками одно то же время пока пул ресурсов не опустеет тогда дополнительные потоки должны ждать пока требуемое количество ресурсов не будет снова доступно события объект хранящий себе бит информации или нет над которым определены операции сбросить состояние ожидать ожидание на событии есть отсутствие операции немедленным продолжением исполнения потока ожидание на событии приводит приостановке исполнения потока до тех пор пока другой поток или же вторая фаза обработчика прерывания ядре ос не событие возможно ожидание нескольких событий режимах любого или всех возможно также создание события автоматически сбрасываемого состояние после пробуждения первого же единственного ожидающего потока такой объект используется как основа для реализации объекта критическая секция активно используются ms windows как режиме пользователя так режиме ядра аналогичный объект имеется ядре linux под названием kwait_queue условные переменные condvars сходны событиями но не являются объектами занимающими память используется только адрес переменной понятие содержимое переменной не существует качестве условной переменной может использоваться адрес произвольного объекта отличие от событий установка условной переменной состояние не влечёт за собой никаких последствий случае если на данный момент нет потоков ожидающих на переменной установка события аналогичном случае влечёт за собой запоминание состояния внутри самого события после чего следующие потоки желающие ожидать события продолжают исполнение немедленно без остановки для полноценного использования такого объекта необходима также операция освободить mutex ожидать условную переменную атомарно активно используются unix подобных ос дискуссии преимуществах недостатках событий условных переменных являются заметной частью дискуссий преимуществах недостатках windows unix порт завершения ввода вывода io completion port iocp реализованный ядре ос доступный через системные вызовы объект очередь операциями поместить структуру хвост очереди взять следующую структуру головы очереди последний вызов исполнение потока случае если очередь пуста до тех пор пока другой поток не осуществит вызов поместить самой важной особенностью iocp является то что структуры него могут помещаться не только явным системным вызовом из режима пользователя но неявно внутри ядра ос как результат завершения асинхронной операции ввода вывода на одном из дескрипторов файлов для достижения такого эффекта необходимо использовать системный вызов связать дескриптор файла iocp этом случае помещенная очередь структура содержит себе код ошибки операции ввода вывода также для случая успеха этой операции число реально введённых или выведенных байт реализация порта завершения также ограничивает число потоков исполняющихся на одном процессоре ядре после получения структуры из очереди объект специфичен для ms windows позволяет обработку входящих запросов соединения порций данных серверном программном обеспечении архитектуре где число потоков может быть меньше числа клиентов нет требования создавать отдельный поток расходами ресурсов на него для каждого нового клиента eresource мьютекс поддерживающий рекурсивный захват семантикой разделяемого или эксклюзивного захвата семантика объект может быть либо свободен либо захвачен произвольным числом потоков разделяемым образом либо захвачен всего одним потоком эксклюзивным образом любые попытки осуществить захваты нарушающее это правило приводят блокировке потока до тех пор пока объект не освободится так чтобы сделать захват разрешённым также есть операции вида trytoacquire никогда не блокирует поток либо захватывает либо если нужна блокировка возвращает false ничего не делая используется ядре windows особенно файловых системах так например любому кем то открытому дисковому файлу соответствует структура fcb которой есть таких объекта для синхронизации доступа размеру файла один из них paging io resource захватывается эксклюзивно только пути обрезания файла гарантирует что момент обрезания на файле нет активного ввода вывода от кэша от отображения память rundown protection вызовы присутствуют файлах заголовках но отсутствуют документации объект ядре windows счетчик операциями увеличить уменьшить ждать ожидание блокирует поток до тех пор пока операции уменьшения не уменьшат счётчик до нуля кроме того операция увеличения может отказать наличие активного данный момент времени ожидания заставляет отказывать все операции увеличения критика терминологии перевод английского термина thread как поток контексте связанном противоречит его же переводу нить общеязыковом контексте также создаёт коллизии термином data stream однако термин поток связан переводами иностранной технической литературы выполненными годах издательством мир настоящее время академических кругах то есть учебниках методических пособиях курсах вузов диссертациях пр он считается эталонным термины же нить тред считаются техническими жаргонизмами см также hyper threading литература примечания ссылки введение технологии параллельного https web archive org web http hardclub donntu edu ua projects qt qq qq mutex html введение многопоточность категория операционная система категория параллельные вычисления категория концепции языков